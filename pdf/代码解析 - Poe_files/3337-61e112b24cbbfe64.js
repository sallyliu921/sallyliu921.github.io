"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3337],{45482:function(e,a,n){n.r(a);let t={kind:"InlineDataFragment",name:"getChatContentType_chat"};t.hash="2291a2b3c3c16aec13efd467f4adefba",a.default=t},43328:function(e,a,n){var t,i,s,l,r,d,o,c,m,u,g,p,k,_,h,b,F,f,y,S,M,v,T,C,L,I,w,U,P,x,A,E,D,N,V,O,B,R,K,G,H,j,z,J,q,Z,W,Q,Y,$;n.r(a);let X=(t=[{defaultValue:null,kind:"LocalArgument",name:"messageId"}],i=[{kind:"Variable",name:"messageId",variableName:"messageId"}],s={kind:"ScalarField",name:"clientNonce"},l={kind:"ScalarField",name:"id"},r={kind:"ScalarField",name:"uid"},d={kind:"ScalarField",name:"fullName"},o={kind:"ScalarField",name:"handle"},c={kind:"ScalarField",name:"viewerIsFollowing"},m={kind:"ScalarField",name:"isDeleted"},u={alias:"smallProfilePhotoUrl",args:[{kind:"Literal",name:"size",value:"small"}],kind:"ScalarField",name:"profilePhotoUrl",storageKey:'profilePhotoUrl(size:"small")'},g={kind:"TypeDiscriminator",abstractKey:"__isNode"},p={kind:"ScalarField",name:"botId"},k={kind:"ScalarField",name:"nickname"},_={kind:"ScalarField",name:"limitedAccessType"},h={kind:"ScalarField",name:"isPrivateBot"},b={kind:"ScalarField",name:"shouldHideLimitedAccessTag"},F={kind:"ScalarField",name:"translatedBotTags"},f={kind:"ScalarField",name:"deletionState"},y={kind:"ScalarField",name:"displayName"},v={kind:"LinkedField",name:"picture",plural:!1,selections:[S={kind:"ScalarField",name:"__typename"},{kind:"TypeDiscriminator",abstractKey:"__isBotPicture"},{kind:"InlineFragment",selections:[{kind:"ScalarField",name:"localName"}],type:"LocalBotImage"},{kind:"InlineFragment",selections:[M={kind:"ScalarField",name:"url"}],type:"URLBotImage"}]},T={kind:"ScalarField",name:"messageId"},C={kind:"ScalarField",name:"text"},L={kind:"ScalarField",name:"sourceType"},I=[r,l],w={kind:"ScalarField",name:"attachmentId"},U={kind:"ScalarField",name:"name"},A={concreteType:"File",kind:"LinkedField",name:"file",plural:!1,selections:[P={kind:"ScalarField",name:"mimeType"},l,x={kind:"ScalarField",name:"size"}]},E={kind:"ScalarField",name:"thumbnailUrl"},V={kind:"InlineFragment",selections:[N={kind:"ClientExtension",selections:[D={kind:"ScalarField",name:"isOptimistic"}]}],type:"MessageAttachment"},O={kind:"ClientExtension",selections:[{kind:"ScalarField",name:"localUrl"}]},B={kind:"ScalarField",name:"commandType"},R={concreteType:"Bot",kind:"LinkedField",name:"bot",plural:!1,selections:[_,h,b,F,f,y,v,o,l,g]},K={concreteType:"PoeUser",kind:"LinkedField",name:"authorUser",plural:!1,selections:[l,r,o,d,c,m,u,g]},H={concreteType:"MessageAttachment",kind:"LinkedField",name:"attachments",plural:!0,selections:[{kind:"InlineFragment",selections:[U,M,G={concreteType:"File",kind:"LinkedField",name:"file",plural:!1,selections:[P,l]}],type:"Attachment",abstractKey:"__isAttachment"},l]},j=[T,l],z={kind:"InlineFragment",selections:[l],type:"Node",abstractKey:"__isNode"},J={kind:"ScalarField",name:"reaction"},q=[{kind:"Literal",name:"first",value:5}],Z={alias:"titleText",kind:"ScalarField",name:"title"},W={alias:"bodyText",kind:"ScalarField",name:"body"},Y={kind:"LinkedField",name:"primaryImageSources",plural:!0,selections:Q=[S,{kind:"TypeDiscriminator",abstractKey:"__isMessageFollowupActionImageSource"},{kind:"InlineFragment",selections:[l,U,M,{concreteType:"File",kind:"LinkedField",name:"file",plural:!1,selections:[P,E,l]}],type:"MessageAttachment"},{kind:"InlineFragment",selections:[l,o,f,y,v],type:"Bot"},z]},{fragment:{argumentDefinitions:t,kind:"Fragment",name:"localMessageQuery",selections:[{args:i,concreteType:"Message",kind:"LinkedField",name:"message",plural:!1,selections:[s,{kind:"InlineDataFragmentSpread",name:"messagesConnection_message",selections:[l,{kind:"FragmentSpread",name:"ChatMessagesView_useMessageTuples_messages"},{kind:"FragmentSpread",name:"ChatHistoryPagedList_message"},{kind:"FragmentSpread",name:"ChatSwitcherPagedList_message"}],argumentDefinitions:[]},{kind:"FragmentSpread",name:"ChatLastMessageArea_lastMessage"},{kind:"FragmentSpread",name:"ChatPageMain_lastMessage"},{kind:"FragmentSpread",name:"ChatLastMessageArea_messageFollowupActions"}]}],type:"QueryRoot"},kind:"Request",operation:{argumentDefinitions:t,kind:"Operation",name:"localMessageQuery",selections:[{args:i,concreteType:"Message",kind:"LinkedField",name:"message",plural:!1,selections:[s,l,{concreteType:"PoeUser",kind:"LinkedField",name:"authorUser",plural:!1,selections:[r,l,d,o,c,m,u,g]},{concreteType:"Bot",kind:"LinkedField",name:"bot",plural:!1,selections:[p,l,{kind:"ScalarField",name:"messageTimeoutSecs"},{kind:"ScalarField",name:"allowsImageAttachments"},o,{kind:"ScalarField",name:"isApiBot"},k,_,h,b,F,f,y,v,{kind:"ScalarField",name:"introduction"},{kind:"ScalarField",name:"supportsRemix"},{kind:"ScalarField",name:"isServerBot"},{kind:"ScalarField",name:"supportsFileUpload"},{kind:"ScalarField",name:"customUIDefinition"},g]},T,{kind:"ScalarField",name:"creationTime"},C,{kind:"ScalarField",name:"state"},{kind:"ScalarField",name:"messageCode"},{kind:"ScalarField",name:"parameters"},{kind:"ScalarField",name:"author"},{kind:"ScalarField",name:"contentType"},L,{kind:"ScalarField",name:"messageStateText"},{kind:"ScalarField",name:"isEdited"},{concreteType:"PoeUser",kind:"LinkedField",name:"usersCanDelete",plural:!0,selections:I},{concreteType:"MessageAttachment",kind:"LinkedField",name:"attachments",plural:!0,selections:[l,w,U,M,A,{kind:"ScalarField",name:"isInline"},{kind:"InlineFragment",selections:[{concreteType:"File",kind:"LinkedField",name:"file",plural:!1,selections:[{kind:"ScalarField",name:"width"},{kind:"ScalarField",name:"height"},M,E]},V,O],type:"Attachment",abstractKey:"__isAttachment"},N]},{concreteType:"CommandInfo",kind:"LinkedField",name:"command",plural:!1,selections:[B]},{kind:"LinkedField",name:"referencedMessageV2",plural:!1,selections:[S,{kind:"TypeDiscriminator",abstractKey:"__isMessageOrDeletedMessage"},{kind:"InlineFragment",selections:[T,C,m,R,K,H,l],type:"Message"},{kind:"InlineFragment",selections:j,type:"DeletedMessage"},z]},{concreteType:"PoeJob",kind:"LinkedField",name:"responsibleJob",plural:!1,selections:[{kind:"ScalarField",name:"jobId"},l,{concreteType:"PoeUser",kind:"LinkedField",name:"creator",plural:!1,selections:I},{kind:"LinkedField",name:"trigger",plural:!1,selections:[S,{kind:"InlineFragment",selections:[{concreteType:"Message",kind:"LinkedField",name:"message",plural:!1,selections:j}],type:"MessageSendJobTrigger"}]}]},{concreteType:"MessageReactionCount",kind:"LinkedField",name:"reactionCounts",plural:!0,selections:[J,{kind:"ScalarField",name:"count"},l]},{kind:"ScalarField",name:"viewerReaction"},{concreteType:"PoeUser",kind:"LinkedField",name:"usersCanEdit",plural:!0,selections:I},{kind:"ScalarField",name:"isChatAnnouncement"},{kind:"ScalarField",name:"hasCitations"},{kind:"ScalarField",name:"textLengthOnCancellation"},{args:q,concreteType:"MessageReactionsConnection",kind:"LinkedField",name:"reactionsConnection",plural:!1,selections:[{concreteType:"MessageReactionEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{concreteType:"MessageReactionNode",kind:"LinkedField",name:"node",plural:!1,selections:[J,{concreteType:"PoeUser",kind:"LinkedField",name:"user",plural:!1,selections:[r,d,{kind:"ScalarField",name:"viewerIsUser"},{alias:"mediumProfilePhotoUrl",args:[{kind:"Literal",name:"size",value:"medium"}],kind:"ScalarField",name:"profilePhotoUrl",storageKey:'profilePhotoUrl(size:"medium")'},l]},l,S]},{kind:"ScalarField",name:"cursor"},l]},{concreteType:"PageInfo",kind:"LinkedField",name:"pageInfo",plural:!1,selections:[{kind:"ScalarField",name:"endCursor"},{kind:"ScalarField",name:"hasNextPage"}]}],storageKey:"reactionsConnection(first:5)"},{args:q,handle:"connection",key:"MessageReactionsModal_message_reactionsConnection",kind:"LinkedHandle",name:"reactionsConnection"},{kind:"LinkedField",name:"followupActions",plural:!0,selections:[S,{kind:"TypeDiscriminator",abstractKey:"__isMessageFollowupActionBase"},{kind:"InlineFragment",selections:[Z,W,{alias:"bodyTextJson",kind:"ScalarField",name:"bodyWhenUsingJsonParams"},{kind:"ScalarField",name:"sendText"},{kind:"ScalarField",name:"sendTextWhenUsingJsonParams"},{kind:"ScalarField",name:"sendParameters"},{concreteType:"MessageAttachment",kind:"LinkedField",name:"sendAttachments",plural:!0,selections:[w,l,{kind:"InlineFragment",selections:[A,U,M,V,O],type:"Attachment",abstractKey:"__isAttachment"}]},Y,$={kind:"LinkedField",name:"secondaryImageSources",plural:!0,selections:Q},{concreteType:"MessageFollowUpTargetBotInfo",kind:"LinkedField",name:"targetBotInfo",plural:!1,selections:[{concreteType:"Bot",kind:"LinkedField",name:"bot",plural:!1,selections:[o,l,p,k,y]}]},{concreteType:"Message",kind:"LinkedField",name:"referencedMessage",plural:!1,selections:[l,{kind:"InlineFragment",selections:[{kind:"InlineFragment",selections:[T,S,C,m,R,K,H],type:"Message"},{kind:"InlineFragment",selections:[T,S],type:"DeletedMessage"}],type:"MessageOrDeletedMessage",abstractKey:"__isMessageOrDeletedMessage"}]},{concreteType:"SendMessageFollowupActionMessageSource",kind:"LinkedField",name:"messageSource",plural:!1,selections:[L,{kind:"ScalarField",name:"metadata"}]}],type:"SendMessageFollowupAction"},{kind:"InlineFragment",selections:[Z,W,{kind:"ScalarField",name:"prefillText"},{concreteType:"MessageAttachment",kind:"LinkedField",name:"prefillAttachments",plural:!0,selections:[w,l,M,U,G,{kind:"InlineFragment",selections:[{concreteType:"File",kind:"LinkedField",name:"file",plural:!1,selections:[x]},V,O],type:"Attachment",abstractKey:"__isAttachment"}]},Y,$],type:"PrefillMessageFollowupAction"},{kind:"InlineFragment",selections:[Z,W,Y,B,{concreteType:"MessageFollowUpTargetBotInfo",kind:"LinkedField",name:"targetBotInfo",plural:!1,selections:[{concreteType:"Bot",kind:"LinkedField",name:"bot",plural:!1,selections:[p,o,l,k,y]}]}],type:"CommandMessageFollowupAction"}]},{kind:"ClientExtension",selections:[D,{kind:"ScalarField",name:"timeoutLevel"},{kind:"ScalarField",name:"heartbeatTimeoutLevel"},{kind:"ScalarField",name:"lastUpdatedText"},{kind:"ScalarField",name:"errorMessage"},{kind:"ScalarField",name:"clientMessageStateText"},{kind:"ScalarField",name:"createStatus"}]},{kind:"InlineFragment",selections:[{kind:"InlineFragment",selections:[S,m],type:"Message"},{kind:"InlineFragment",selections:[S],type:"DeletedMessage"}],type:"MessageOrDeletedMessage",abstractKey:"__isMessageOrDeletedMessage"},g]}]},params:{id:"abb5a69fdc1922426f8bbf076547690870ed1041e7793844eb26b7df269db5fa",metadata:{},name:"localMessageQuery",operationKind:"query",text:null}});X.hash="4a10823f71fc99ce1020cc5bf18c1a64",a.default=X},42074:function(e,a,n){n.r(a);let t={kind:"InlineDataFragment",name:"localMessage_createLocalChatMessage_bot"};t.hash="56ea691be54c0931a67823a3e0f77b74",a.default=t},52751:function(e,a,n){n.r(a);let t={kind:"InlineDataFragment",name:"localMessage_createLocalChatMessage_job"};t.hash="23b0940a2af82b0d609f4fd622f165c3",a.default=t},88928:function(e,a,n){n.r(a);let t={kind:"InlineDataFragment",name:"localMessage_createLocalChatMessage_referencedMessage"};t.hash="aa5611649349d3ca3ca85623a71f79c6",a.default=t},10145:function(e,a,n){n.r(a);let t={kind:"InlineDataFragment",name:"optimisticMessage_createOptimisticBotMessage_bot"};t.hash="c40562515293ee0a349dcd825f615c78",a.default=t},86294:function(e,a,n){var t,i;n.r(a);let s={fragment:{argumentDefinitions:t=[{defaultValue:null,kind:"LocalArgument",name:"fileInfos"}],kind:"Fragment",name:"presignedUrlFileUpload_generatePresignedUrls_Mutation",selections:i=[{args:[{kind:"Variable",name:"fileInfos",variableName:"fileInfos"}],concreteType:"GeneratePresignedUrls",kind:"LinkedField",name:"generatePresignedUrls",plural:!1,selections:[{kind:"ScalarField",name:"presignedUrls"},{kind:"ScalarField",name:"status"}]}],type:"MutationRoot"},kind:"Request",operation:{argumentDefinitions:t,kind:"Operation",name:"presignedUrlFileUpload_generatePresignedUrls_Mutation",selections:i},params:{id:"179d3ee06126989372d2cecd4bb5dba4b79051f77406615a6c74aa1bc27f617e",metadata:{},name:"presignedUrlFileUpload_generatePresignedUrls_Mutation",operationKind:"mutation",text:null}};s.hash="8277db09b76e6e5ac1785bfd93b239fe",a.default=s},89340:function(e,a,n){n.r(a);let t={kind:"InlineDataFragment",name:"resendMessage_bot"};t.hash="dd2b0610e4bd5a8280817ddcdd093f52",a.default=t},21049:function(e,a,n){n.r(a);let t={kind:"InlineDataFragment",name:"resendMessage_chat"};t.hash="18d6b5bb8062a445ad9f0eb2fd4f5f1d",a.default=t},40273:function(e,a,n){n.r(a);let t={kind:"InlineDataFragment",name:"resendMessage_message"};t.hash="e56e3fa2233e8ab03a48556a6fc0f1ec",a.default=t},71883:function(e,a,n){n.r(a);let t={kind:"InlineDataFragment",name:"resendMessage_viewer"};t.hash="430829d0c6117a06aef6e3c7398e1ed3",a.default=t},57868:function(e,a,n){var t,i,s,l,r,d,o,c,m,u,g,p,k,_,h,b,F,f,y,S,M,v,T,C,L,I,w,U,P,x,A,E,D,N,V,O,B,R,K,G,H,j,z,J,q,Z,W,Q,Y,$,X,ee,ea,en,et,ei,es,el,er,ed,eo,ec,em,eu,eg,ep,ek,e_,eh,eb,eF,ef,ey,eS,eM,ev,eT,eC,eL,eI,ew,eU,eP,ex,eA,eE,eD,eN,eV,eO,eB,eR,eK,eG,eH,ej,ez,eJ,eq,eZ,eW,eQ,eY,e$,eX,e0,e1,e2,e5,e4,e8,e3,e6,e7,e9,ae,aa,an,at,ai,as,al,ar,ad,ao,ac,am,au,ag;n.r(a);let ap=(t={defaultValue:null,kind:"LocalArgument",name:"attachments"},i={defaultValue:null,kind:"LocalArgument",name:"bot"},s={defaultValue:null,kind:"LocalArgument",name:"chatId"},l={defaultValue:null,kind:"LocalArgument",name:"clientNonce"},r={defaultValue:null,kind:"LocalArgument",name:"existingMessageAttachmentsIds"},d={defaultValue:null,kind:"LocalArgument",name:"fileHashJwts"},o={defaultValue:null,kind:"LocalArgument",name:"parameters"},c={defaultValue:null,kind:"LocalArgument",name:"query"},m={defaultValue:null,kind:"LocalArgument",name:"referencedMessageId"},u={defaultValue:null,kind:"LocalArgument",name:"sdid"},g={defaultValue:null,kind:"LocalArgument",name:"shouldFetchChat"},p={defaultValue:null,kind:"LocalArgument",name:"source"},k=[{kind:"Variable",name:"attachments",variableName:"attachments"},{kind:"Variable",name:"bot",variableName:"bot"},{kind:"Variable",name:"chatId",variableName:"chatId"},{kind:"Variable",name:"clientNonce",variableName:"clientNonce"},{kind:"Variable",name:"existingMessageAttachmentsIds",variableName:"existingMessageAttachmentsIds"},{kind:"Variable",name:"fileHashJwts",variableName:"fileHashJwts"},{kind:"Variable",name:"parameters",variableName:"parameters"},{kind:"Variable",name:"query",variableName:"query"},{kind:"Variable",name:"referencedMessageId",variableName:"referencedMessageId"},{kind:"Variable",name:"sdid",variableName:"sdid"},{kind:"Variable",name:"source",variableName:"source"}],y={concreteType:"Message",kind:"LinkedField",name:"node",plural:!1,selections:[h={kind:"ScalarField",name:"messageId"},b={kind:"ScalarField",name:"creationTime"},{kind:"InlineDataFragmentSpread",name:"messagesConnection_message",selections:[_={kind:"ScalarField",name:"id"},{kind:"FragmentSpread",name:"ChatMessagesView_useMessageTuples_messages"},F={kind:"FragmentSpread",name:"ChatHistoryPagedList_message"},f={kind:"FragmentSpread",name:"ChatSwitcherPagedList_message"}],argumentDefinitions:[]},F,f]},S={kind:"ScalarField",name:"status"},M={kind:"ScalarField",name:"statusMessage"},T={concreteType:"MessageCreateFailedUrl",kind:"LinkedField",name:"failedUrls",plural:!0,selections:[v={kind:"ScalarField",name:"url"},{kind:"ScalarField",name:"reason"}]},L={concreteType:"PoeJob",kind:"LinkedField",name:"job",plural:!1,selections:[_,C={kind:"ScalarField",name:"jobId"}]},I={kind:"ScalarField",name:"chatId"},w={kind:"ScalarField",name:"chatCode"},U={kind:"ScalarField",name:"title"},P={kind:"ScalarField",name:"handle"},A={kind:"ScalarField",name:"viewerCanCancel"},E={kind:"ScalarField",name:"hasMarkdownRendering"},K={kind:"InlineDataFragmentSpread",name:"sendMessage_handleOptimisticTabInNewChat_chat",selections:[_,{kind:"InlineDataFragmentSpread",name:"sendMessage_areSameCanvasTab_chat",selections:[{args:D=[{kind:"Literal",name:"first",value:2}],concreteType:"CanvasTabConnection",kind:"LinkedField",name:"canvasTabsConnection",plural:!1,selections:[{concreteType:"CanvasTabEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{kind:"LinkedField",name:"node",plural:!1,selections:[N={kind:"ScalarField",name:"__typename"},_]}]}],storageKey:"canvasTabsConnection(first:2)"}],argumentDefinitions:[]},{kind:"LinkedField",name:"canvasTabInForeground",plural:!1,selections:[_,{kind:"InlineDataFragmentSpread",name:"sendMessage_areSameCanvasTab_canvasTab",selections:[N,O={kind:"InlineFragment",selections:V=[x={kind:"ScalarField",name:"botId"}],type:"BotCanvasTab"}],argumentDefinitions:[]}]},R={kind:"ClientExtension",selections:[B={kind:"ScalarField",name:"isOptimistic"}]}],argumentDefinitions:[]},G={kind:"FragmentSpread",name:"ChatPageColumn_chat"},H={kind:"ScalarField",name:"nickname"},Q={kind:"TypeDiscriminator",abstractKey:"__isNode"},Y={concreteType:"PoeUser",kind:"LinkedField",name:"authorUser",plural:!1,selections:[j={kind:"ScalarField",name:"uid"},_,z={kind:"ScalarField",name:"fullName"},P,J={kind:"ScalarField",name:"viewerIsFollowing"},q={kind:"ScalarField",name:"isDeleted"},W={alias:"smallProfilePhotoUrl",args:Z=[{kind:"Literal",name:"size",value:"small"}],kind:"ScalarField",name:"profilePhotoUrl",storageKey:'profilePhotoUrl(size:"small")'},Q]},eo={concreteType:"Bot",kind:"LinkedField",name:"bot",plural:!1,selections:[x,_,$={kind:"ScalarField",name:"messageTimeoutSecs"},X={kind:"ScalarField",name:"allowsImageAttachments"},P,ee={kind:"ScalarField",name:"isApiBot"},H,ea={kind:"ScalarField",name:"limitedAccessType"},en={kind:"ScalarField",name:"isPrivateBot"},et={kind:"ScalarField",name:"shouldHideLimitedAccessTag"},ei={kind:"ScalarField",name:"translatedBotTags"},es={kind:"ScalarField",name:"deletionState"},el={kind:"ScalarField",name:"displayName"},ed={kind:"LinkedField",name:"picture",plural:!1,selections:er=[N,{kind:"TypeDiscriminator",abstractKey:"__isBotPicture"},{kind:"InlineFragment",selections:[{kind:"ScalarField",name:"localName"}],type:"LocalBotImage"},{kind:"InlineFragment",selections:[v],type:"URLBotImage"}]},Q]},ec={kind:"ScalarField",name:"text"},em={kind:"ScalarField",name:"state"},eu={kind:"ScalarField",name:"clientNonce"},eg={kind:"ScalarField",name:"messageCode"},ep={kind:"ScalarField",name:"parameters"},ek={kind:"ScalarField",name:"author"},e_={kind:"ScalarField",name:"contentType"},eh={kind:"ScalarField",name:"sourceType"},eb={kind:"ScalarField",name:"messageStateText"},eF={kind:"ScalarField",name:"isEdited"},ey={concreteType:"PoeUser",kind:"LinkedField",name:"usersCanDelete",plural:!0,selections:ef=[j,_]},eS={kind:"ScalarField",name:"attachmentId"},eM={kind:"ScalarField",name:"name"},eT={concreteType:"File",kind:"LinkedField",name:"file",plural:!1,selections:[ev={kind:"ScalarField",name:"mimeType"},_,{kind:"ScalarField",name:"size"}]},eC={kind:"ScalarField",name:"isInline"},eL={concreteType:"File",kind:"LinkedField",name:"file",plural:!1,selections:[{kind:"ScalarField",name:"width"},{kind:"ScalarField",name:"height"},v,{kind:"ScalarField",name:"thumbnailUrl"}]},eI={kind:"InlineFragment",selections:[R],type:"MessageAttachment"},ew={kind:"ClientExtension",selections:[{kind:"ScalarField",name:"localUrl"}]},eU={concreteType:"CommandInfo",kind:"LinkedField",name:"command",plural:!1,selections:[{kind:"ScalarField",name:"commandType"}]},ex={kind:"InlineFragment",selections:eP=[_],type:"Node",abstractKey:"__isNode"},eA={kind:"LinkedField",name:"referencedMessageV2",plural:!1,selections:[N,{kind:"TypeDiscriminator",abstractKey:"__isMessageOrDeletedMessage"},{kind:"InlineFragment",selections:[h,ec,q,{concreteType:"Bot",kind:"LinkedField",name:"bot",plural:!1,selections:[ea,en,et,ei,es,el,ed,P,_,Q]},{concreteType:"PoeUser",kind:"LinkedField",name:"authorUser",plural:!1,selections:[_,j,P,z,J,q,W,Q]},{concreteType:"MessageAttachment",kind:"LinkedField",name:"attachments",plural:!0,selections:[{kind:"InlineFragment",selections:[eM,v,{concreteType:"File",kind:"LinkedField",name:"file",plural:!1,selections:[ev,_]}],type:"Attachment",abstractKey:"__isAttachment"},_]}],type:"Message"},ex]},eE={concreteType:"PoeJob",kind:"LinkedField",name:"responsibleJob",plural:!1,selections:[C,_]},eN={concreteType:"MessageReactionCount",kind:"LinkedField",name:"reactionCounts",plural:!0,selections:[eD={kind:"ScalarField",name:"reaction"},{kind:"ScalarField",name:"count"},_]},eV={kind:"ScalarField",name:"viewerReaction"},eO={concreteType:"PoeUser",kind:"LinkedField",name:"usersCanEdit",plural:!0,selections:ef},eB={kind:"ScalarField",name:"isChatAnnouncement"},eR={kind:"ScalarField",name:"hasCitations"},eK={kind:"ScalarField",name:"textLengthOnCancellation"},eJ={args:eG=[{kind:"Literal",name:"first",value:5}],concreteType:"MessageReactionsConnection",kind:"LinkedField",name:"reactionsConnection",plural:!1,selections:[{concreteType:"MessageReactionEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{concreteType:"MessageReactionNode",kind:"LinkedField",name:"node",plural:!1,selections:[eD,{concreteType:"PoeUser",kind:"LinkedField",name:"user",plural:!1,selections:[j,z,eH={kind:"ScalarField",name:"viewerIsUser"},{alias:"mediumProfilePhotoUrl",args:[{kind:"Literal",name:"size",value:"medium"}],kind:"ScalarField",name:"profilePhotoUrl",storageKey:'profilePhotoUrl(size:"medium")'},_]},_,N]},ej={kind:"ScalarField",name:"cursor"},_]},ez={concreteType:"PageInfo",kind:"LinkedField",name:"pageInfo",plural:!1,selections:[{kind:"ScalarField",name:"endCursor"},{kind:"ScalarField",name:"hasNextPage"}]}],storageKey:"reactionsConnection(first:5)"},eQ={concreteType:"Message",kind:"LinkedField",name:"node",plural:!1,selections:[h,b,_,Y,eo,ec,em,eu,eg,ep,ek,e_,eh,eb,eF,ey,{concreteType:"MessageAttachment",kind:"LinkedField",name:"attachments",plural:!0,selections:[_,eS,eM,v,eT,eC,{kind:"InlineFragment",selections:[eL,eI,ew],type:"Attachment",abstractKey:"__isAttachment"},R]},eU,eA,eE,eN,eV,eO,eB,eR,eK,eJ,eq={args:eG,handle:"connection",key:"MessageReactionsModal_message_reactionsConnection",kind:"LinkedHandle",name:"reactionsConnection"},eW={kind:"ClientExtension",selections:[B,eZ={kind:"ScalarField",name:"timeoutLevel"},{kind:"ScalarField",name:"heartbeatTimeoutLevel"},{kind:"ScalarField",name:"lastUpdatedText"},{kind:"ScalarField",name:"errorMessage"},{kind:"ScalarField",name:"clientMessageStateText"}]},{kind:"InlineFragment",selections:[{kind:"InlineFragment",selections:[N,q],type:"Message"},{kind:"InlineFragment",selections:[N],type:"DeletedMessage"}],type:"MessageOrDeletedMessage",abstractKey:"__isMessageOrDeletedMessage"},Q]},eY={kind:"ScalarField",name:"introduction"},e$={kind:"ScalarField",name:"supportsRemix"},eX={kind:"ScalarField",name:"isServerBot"},e0={kind:"ScalarField",name:"supportsFileUpload"},e1={kind:"ScalarField",name:"customUIDefinition"},e2={kind:"ScalarField",name:"viewerIsCreator"},e5={kind:"ScalarField",name:"content"},e4={kind:"ScalarField",name:"language"},e8={kind:"ScalarField",name:"isCanvasOnlyBot"},e3={concreteType:"PoeUser",kind:"LinkedField",name:"creator",plural:!1,selections:[q,{args:Z,kind:"ScalarField",name:"profilePhotoUrl",storageKey:'profilePhotoUrl(size:"small")'},z,{alias:"nullableHandle",kind:"ScalarField",name:"handle"},_,Q]},e6={kind:"ScalarField",name:"canUserAccessBot"},e7={kind:"ScalarField",name:"poweredBy"},ae={kind:"TypeDiscriminator",abstractKey:"__isCanvasTabInterface"},aa={kind:"ScalarField",name:"codeblockIndex"},an={kind:"ScalarField",name:"globalId"},at={kind:"ScalarField",name:"canvasCode"},ai={concreteType:"Bot",kind:"LinkedField",name:"bot",plural:!1,selections:[x,_,P,e2,es,e9={kind:"ScalarField",name:"isPromptPublic"},e8,en,{concreteType:"PreviewContentObject",kind:"LinkedField",name:"canvasContent",plural:!1,selections:[e5,e_]}]},as={concreteType:"Message",kind:"LinkedField",name:"message",plural:!1,selections:[h,_,em]},al={kind:"ClientExtension",selections:[B,{kind:"ScalarField",name:"idWhenWasOptimistic"}]},ar=[h,_],ad=[{kind:"Literal",name:"last",value:12}],ao=[U],ac={kind:"ScalarField",name:"costBreakdown"},am={concreteType:"Bot",kind:"LinkedField",name:"bot",plural:!1,selections:[x,H,el,_,P,es,ed]},au={concreteType:"Chat",kind:"LinkedField",name:"chat",plural:!1,selections:[I,_]},{fragment:{argumentDefinitions:[t,i,s,l,r,d,o,c,m,u,g,p],kind:"Fragment",name:"sendMessageMutation",selections:[{args:k,concreteType:"MessageEdgeCreate",kind:"LinkedField",name:"messageEdgeCreate",plural:!1,selections:[{concreteType:"MessageEdge",kind:"LinkedField",name:"message",plural:!1,selections:[_,y,{kind:"FragmentSpread",name:"sendMessageMutation_messageEdge"}]},S,M,T,{concreteType:"MessageEdge",kind:"LinkedField",name:"botMessage",plural:!1,selections:[_,y]},L,{condition:"shouldFetchChat",kind:"Condition",passingValue:!0,selections:[{concreteType:"Chat",kind:"LinkedField",name:"chat",plural:!1,selections:[_,I,w,U,{concreteType:"Bot",kind:"LinkedField",name:"defaultBotObject",plural:!1,selections:[_,P,x]},{concreteType:"PoeJob",kind:"LinkedField",name:"activeJobs",plural:!0,selections:[A]},{kind:"InlineDataFragmentSpread",name:"sendMessage_newChatUpdater_chat",selections:[_,I,w,{kind:"InlineDataFragmentSpread",name:"getChatContentType_chat",selections:[{concreteType:"Bot",kind:"LinkedField",name:"defaultBotObject",plural:!1,selections:[E]}],argumentDefinitions:[]},K],argumentDefinitions:[]},K,{kind:"FragmentSpread",name:"ChatHistoryListItem_chat"},G,{kind:"InlineDataFragmentSpread",name:"useNavigateFromOptimisticChatToRealChat_chat",selections:[w,{concreteType:"Bot",kind:"LinkedField",name:"defaultBotObject",plural:!1,selections:V},G],argumentDefinitions:[]}]},{concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{kind:"FragmentSpread",name:"ChatPageColumn_viewer"}]}]},{concreteType:"Bot",kind:"LinkedField",name:"bot",plural:!1,selections:[{kind:"InlineDataFragmentSpread",name:"sendMessage_onSuccessUpdater_bot",selections:[x,{kind:"InlineDataFragmentSpread",name:"optimisticMessage_createOptimisticBotMessage_bot",selections:[H,{kind:"InlineDataFragmentSpread",name:"localMessage_createLocalChatMessage_bot",selections:[_,{kind:"FragmentSpread",name:"ChatMessage_bot"},{kind:"FragmentSpread",name:"ChatLastMessageArea_bot"},{kind:"FragmentSpread",name:"ChatPageMain_targetedBot"}],argumentDefinitions:[]}],argumentDefinitions:[]}],argumentDefinitions:[]}]}]}],type:"MutationRoot"},kind:"Request",operation:{argumentDefinitions:[s,i,c,p,l,u,t,r,g,m,o,d],kind:"Operation",name:"sendMessageMutation",selections:[{args:k,concreteType:"MessageEdgeCreate",kind:"LinkedField",name:"messageEdgeCreate",plural:!1,selections:[{concreteType:"MessageEdge",kind:"LinkedField",name:"message",plural:!1,selections:[_,eQ,ej]},S,M,T,{concreteType:"MessageEdge",kind:"LinkedField",name:"botMessage",plural:!1,selections:[_,eQ]},L,{concreteType:"Bot",kind:"LinkedField",name:"bot",plural:!1,selections:[x,H,_,$,X,P,ee,ea,en,et,ei,es,el,ed,eY,e$,eX,e0,e1,Q]},{condition:"shouldFetchChat",kind:"Condition",passingValue:!0,selections:[{concreteType:"Chat",kind:"LinkedField",name:"chat",plural:!1,selections:[_,I,w,U,{concreteType:"Bot",kind:"LinkedField",name:"defaultBotObject",plural:!1,selections:[_,P,x,E,es,el,ed,{alias:"smallPicture",args:Z,kind:"LinkedField",name:"picture",plural:!1,selections:er,storageKey:'picture(size:"small")'},eY,H,e2,{kind:"ScalarField",name:"isTrustedBot"},en,{concreteType:"PreviewContentObject",kind:"LinkedField",name:"canvasContent",plural:!1,selections:[e5,e_,e4]},$,X,ee,ea,et,ei,e$,eX,e0,e1,{kind:"ScalarField",name:"isCreatedByPoeUserAccount"},{kind:"ScalarField",name:"viewerIsFollower"},{kind:"ScalarField",name:"followerCount"},{kind:"ScalarField",name:"shareLink"},{kind:"ScalarField",name:"isDown"},{kind:"ScalarField",name:"model"},{kind:"ScalarField",name:"uploadFileSizeLimit"},{kind:"ScalarField",name:"noAccessMessage"},{kind:"ScalarField",name:"allowsClearContext"},{kind:"ScalarField",name:"conversationStarters"},e8,{kind:"ScalarField",name:"monthlyActiveUsers"},e3,e6,{concreteType:"BotPricing",kind:"LinkedField",name:"botPricing",plural:!1,selections:[{kind:"ScalarField",name:"botPricingLabel"}]},{kind:"ScalarField",name:"description"},e7,e9,{kind:"ScalarField",name:"promptPlaintext"},{kind:"ScalarField",name:"shouldHide"},{kind:"ScalarField",name:"isOfficialBot"},{kind:"ScalarField",name:"botCategory"},Q]},{concreteType:"PoeJob",kind:"LinkedField",name:"activeJobs",plural:!0,selections:[A,_,C]},{args:D,concreteType:"CanvasTabConnection",kind:"LinkedField",name:"canvasTabsConnection",plural:!1,selections:[{concreteType:"CanvasTabEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{kind:"LinkedField",name:"node",plural:!1,selections:[N,_,ae,em,{concreteType:"PreviewContentObject",kind:"LinkedField",name:"previewContentObject",plural:!1,selections:[e_,e4]},{kind:"InlineFragment",selections:[h,aa,{kind:"InlineFragment",selections:[U,an,{concreteType:"PreviewContentObject",kind:"LinkedField",name:"previewContentObject",plural:!1,selections:[e5]},eu,at,{kind:"InlineFragment",selections:[x,ai,R],type:"BotCanvasTab"},{kind:"InlineFragment",selections:[as,R],type:"MessageCanvasTab"},Q],type:"CanvasTabInterface",abstractKey:"__isCanvasTabInterface"},R],type:"MessageCanvasTab"},O]},_,ej]},_,ez],storageKey:"canvasTabsConnection(first:2)"},{args:D,handle:"connection",key:"CanvasTabSelector_canvasTabsConnection",kind:"LinkedHandle",name:"canvasTabsConnection"},{kind:"LinkedField",name:"canvasTabInForeground",plural:!1,selections:[N,_,ae,em,U,an,{concreteType:"PreviewContentObject",kind:"LinkedField",name:"previewContentObject",plural:!1,selections:[e_,e4,e5]},eu,at,{kind:"InlineFragment",selections:[x,ai,al],type:"BotCanvasTab"},{kind:"InlineFragment",selections:[h,aa,as,al,{kind:"InlineFragment",selections:[Q],type:"CanvasTabInterface",abstractKey:"__isCanvasTabInterface"}],type:"MessageCanvasTab"},Q]},{kind:"ScalarField",name:"lastInteractionTime"},{concreteType:"PoeUser",kind:"LinkedField",name:"owner",plural:!1,selections:ef},{kind:"ScalarField",name:"unseenItemCount"},{kind:"ScalarField",name:"hasMultipleUsers"},{kind:"ScalarField",name:"membersCount"},{args:D,concreteType:"ChatMembersConnection",kind:"LinkedField",name:"userMembersConnection",plural:!1,selections:[{concreteType:"ChatMemberEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{kind:"LinkedField",name:"node",plural:!1,selections:[N,{kind:"InlineFragment",selections:[j,W,z],type:"PoeUser"},_]},_]}],storageKey:"userMembersConnection(first:2)"},{kind:"ScalarField",name:"viewerHasMutedChat"},q,{kind:"ScalarField",name:"canvasTabsCount"},{concreteType:"Bot",kind:"LinkedField",name:"chatSettingsFieldBotToEdit",plural:!1,selections:[x,_,{concreteType:"PoeUser",kind:"LinkedField",name:"creator",plural:!1,selections:[eH,_]}]},{concreteType:"Message",kind:"LinkedField",name:"viewerLastSeenMessage",plural:!1,selections:ar},{kind:"ScalarField",name:"shouldBotAutoRespond"},b,{concreteType:"Message",kind:"LinkedField",name:"lastMessage",plural:!1,selections:[ek,em,_,eK,{kind:"ClientExtension",selections:[B,eZ]},{concreteType:"Bot",kind:"LinkedField",name:"bot",plural:!1,selections:[e$,P,_,eX,X,e0,e1,es,x,H,el]}]},{concreteType:"Message",kind:"LinkedField",name:"lastMessageSeenByAllOtherMembers",plural:!1,selections:ar},{args:ad,concreteType:"MessagesConnection",kind:"LinkedField",name:"messagesConnection",plural:!1,selections:[{concreteType:"MessageEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{concreteType:"Message",kind:"LinkedField",name:"node",plural:!1,selections:[ek,eB,_,Y,eo,h,b,ec,em,eu,eg,ep,e_,eh,eb,eF,ey,{concreteType:"MessageAttachment",kind:"LinkedField",name:"attachments",plural:!0,selections:[_,eS,eM,v,eT,{kind:"InlineFragment",selections:[eC,eL,eI,ew],type:"Attachment",abstractKey:"__isAttachment"},R]},eU,eA,eE,eN,eV,eO,eR,eK,eJ,eq,N,eW,{kind:"InlineFragment",selections:[{kind:"InlineFragment",selections:[q],type:"Message"}],type:"MessageOrDeletedMessage",abstractKey:"__isMessageOrDeletedMessage"},Q]},_,ej]},{concreteType:"PageInfo",kind:"LinkedField",name:"pageInfo",plural:!1,selections:[{kind:"ScalarField",name:"hasPreviousPage"},{kind:"ScalarField",name:"startCursor"}]},_],storageKey:"messagesConnection(last:12)"},{args:ad,handle:"connection",key:"ChatMessagesView_chat_messagesConnection",kind:"LinkedHandle",name:"messagesConnection"},{kind:"LinkedField",name:"displayedChatModal",plural:!1,selections:[N,{kind:"InlineFragment",selections:[I,{concreteType:"Bot",kind:"LinkedField",name:"bot",plural:!1,selections:[P,es,el,ed,_]},{kind:"LinkedField",name:"budgetIncreaseRequester",plural:!1,selections:[N,{kind:"InlineFragment",selections:[P],type:"Bot"},{kind:"InlineFragment",selections:ao,type:"MessageCanvasTab"},{kind:"InlineFragment",selections:ao,type:"BotCanvasTab"},ex]},{kind:"ScalarField",name:"applicablePointPriceThreshold"},{kind:"ScalarField",name:"totalRequestAmount"},h,ac,{concreteType:"MessagePointInfo",kind:"LinkedField",name:"messagePointInfo",plural:!1,selections:[{kind:"ScalarField",name:"messagePointBalance"},_]}],type:"CostThresholdUpdateChatModal"},{kind:"InlineFragment",selections:[I,am,au,b],type:"PaywallChatModal"},{kind:"InlineFragment",selections:[I,am,au,b,ag={kind:"ScalarField",name:"messageCostAmount"},ac],type:"PointLimitPaywallChatModal"},{kind:"InlineFragment",selections:[I,b,{concreteType:"Bot",kind:"LinkedField",name:"bot",plural:!1,selections:[P,es,el,ed,_,x,H]},ag,ac,{kind:"ScalarField",name:"subscriberPointLimitSubtext"}],type:"SubscriberPointLimitChatModal"},{kind:"InlineFragment",selections:[au,{concreteType:"Bot",kind:"LinkedField",name:"bot",plural:!1,selections:[x,_,e7,es,el,ed,P,{concreteType:"BotPricing",kind:"LinkedField",name:"botPricing",plural:!1,selections:[{kind:"ScalarField",name:"botPricingType"},{kind:"ScalarField",name:"standardMessagePrice"}]},en,e3,e6]},{kind:"ScalarField",name:"isPrivateDeletedBotsChangesEnabled"}],type:"AddBotChatModal"},ex]},{kind:"ScalarField",name:"isContextOptimizationOn"},{kind:"ScalarField",name:"membersIncludeUntrustedBot"},R,Q]},{concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{kind:"ScalarField",name:"unseenChatCount"},{concreteType:"PoeUser",kind:"LinkedField",name:"poeUser",plural:!1,selections:[_,N]},{alias:"useInFrameCanvasServerRelay",args:[{kind:"Literal",name:"gateName",value:"poe_web_canvas_use_in_frame_canvas_server_relay"}],kind:"ScalarField",name:"booleanGate",storageKey:'booleanGate(gateName:"poe_web_canvas_use_in_frame_canvas_server_relay")'},{alias:"enableCanvasAppDebugMode",args:[{kind:"Literal",name:"gateName",value:"poe_canvas_enable_debug_mode"}],kind:"ScalarField",name:"booleanGate",storageKey:'booleanGate(gateName:"poe_canvas_enable_debug_mode")'},{alias:"persistenceAndSyncEnabled",args:[{kind:"Literal",name:"gateName",value:"poe_web_enable_canvas_data_store"}],kind:"ScalarField",name:"booleanGate",storageKey:'booleanGate(gateName:"poe_web_enable_canvas_data_store")'},{alias:"codeEditorCanvasBotId",args:[{kind:"Literal",name:"gateName",value:"poe_web_code_editor_canvas_bot_id"}],kind:"ScalarField",name:"integerGate",storageKey:'integerGate(gateName:"poe_web_code_editor_canvas_bot_id")'},{alias:"editCanvasTabPrimaryButtonEnabled",args:[{kind:"Literal",name:"gateName",value:"poe_web_enable_edit_app_primary_button_in_canvas_tab_header"}],kind:"ScalarField",name:"booleanGate",storageKey:'booleanGate(gateName:"poe_web_enable_edit_app_primary_button_in_canvas_tab_header")'},{alias:"canvasActionsEnabled",args:[{kind:"Literal",name:"gateName",value:"poe_enable_canvas_tab_actions"}],kind:"ScalarField",name:"booleanGate",storageKey:'booleanGate(gateName:"poe_enable_canvas_tab_actions")'},{alias:"canvasPreviewUrlOverride",args:[{kind:"Literal",name:"gateName",value:"poe_web_canvas_preview_url_override"}],kind:"ScalarField",name:"stringGate",storageKey:'stringGate(gateName:"poe_web_canvas_preview_url_override")'},{alias:"shouldUseFinishUploadEndpoint",args:[{kind:"Literal",name:"gateName",value:"poe_file_upload_use_finish_upload_endpoint"}],kind:"ScalarField",name:"booleanGate",storageKey:'booleanGate(gateName:"poe_file_upload_use_finish_upload_endpoint")'},{alias:"shouldUsePresignedUrl",args:[{kind:"Literal",name:"gateName",value:"poe_file_upload_use_presigned_url"}],kind:"ScalarField",name:"booleanGate",storageKey:'booleanGate(gateName:"poe_file_upload_use_presigned_url")'},{alias:"useMessageSendingIcon",args:[{kind:"Literal",name:"gateName",value:"poe_use_message_sending_icon"}],kind:"ScalarField",name:"booleanGate",storageKey:'booleanGate(gateName:"poe_use_message_sending_icon")'},{alias:"poeEnableMultiUserInvite",args:[{kind:"Literal",name:"gateName",value:"poe_enable_multi_user_invite"}],kind:"ScalarField",name:"booleanGate",storageKey:'booleanGate(gateName:"poe_enable_multi_user_invite")'},j,{alias:"privateBotQueryAccessEnabled",args:[{kind:"Literal",name:"gateName",value:"poe_bot_query_private_bot_access_enabled"}],kind:"ScalarField",name:"booleanGate",storageKey:'booleanGate(gateName:"poe_bot_query_private_bot_access_enabled")'},_,{alias:"enablePrivacyShieldUpdates",args:[{kind:"Literal",name:"gateName",value:"poe_web_privacy_shield_updates"}],kind:"ScalarField",name:"booleanGate",storageKey:'booleanGate(gateName:"poe_web_privacy_shield_updates")'},{alias:"shouldHideBotInfoCardWithAutoReplyOff",args:[{kind:"Literal",name:"gateName",value:"poe_hide_bot_info_card_with_auto_reply_off"}],kind:"ScalarField",name:"booleanGate",storageKey:'booleanGate(gateName:"poe_hide_bot_info_card_with_auto_reply_off")'},{alias:"poeWebChatNewScrollBehavior",args:[{kind:"Literal",name:"gateName",value:"poe_web_chat_new_scroll_behavior"}],kind:"ScalarField",name:"stringGate",storageKey:'stringGate(gateName:"poe_web_chat_new_scroll_behavior")'},{alias:"poeHideLeftSideMessageHeaderIfSameSender",args:[{kind:"Literal",name:"gateName",value:"poe_hide_left_side_message_header_if_same_sender"}],kind:"ScalarField",name:"booleanGate",storageKey:'booleanGate(gateName:"poe_hide_left_side_message_header_if_same_sender")'},{alias:"markdownCharacterLimit",args:[{kind:"Literal",name:"gateName",value:"poe_web_markdown_character_limit"}],kind:"ScalarField",name:"integerGate",storageKey:'integerGate(gateName:"poe_web_markdown_character_limit")'},{alias:"botMarkdownCharacterLimit",args:[{kind:"Literal",name:"gateName",value:"poe_web_bot_markdown_character_limit"}],kind:"ScalarField",name:"integerGate",storageKey:'integerGate(gateName:"poe_web_bot_markdown_character_limit")'},{kind:"ScalarField",name:"promptBotImageDomainWhitelist"},{alias:"enableScriptingCodeReference",args:[{kind:"Literal",name:"gateName",value:"poe_enable_scripting_code_blocks"}],kind:"ScalarField",name:"booleanGate",storageKey:'booleanGate(gateName:"poe_enable_scripting_code_blocks")'},{alias:"enableScriptBotCreation",args:[{kind:"Literal",name:"gateName",value:"poe_web_script_bot_creation"}],kind:"ScalarField",name:"booleanGate",storageKey:'booleanGate(gateName:"poe_web_script_bot_creation")'},{alias:"enableMessageReplies",args:[{kind:"Literal",name:"gateName",value:"poe_web_enable_message_replies"}],kind:"ScalarField",name:"booleanGate",storageKey:'booleanGate(gateName:"poe_web_enable_message_replies")'},{alias:"messageBranchingEnabled",args:[{kind:"Literal",name:"gateName",value:"poe_message_branching"}],kind:"ScalarField",name:"booleanGate",storageKey:'booleanGate(gateName:"poe_message_branching")'},{kind:"ScalarField",name:"isEligibleForWebSubscriptions"},{concreteType:"Subscription",kind:"LinkedField",name:"subscription",plural:!1,selections:[{kind:"ScalarField",name:"isActive"},_,{concreteType:"SubscriptionProduct",kind:"LinkedField",name:"subscriptionProduct",plural:!1,selections:[{kind:"ScalarField",name:"paidSubscriptionPeriod"},_,{kind:"ScalarField",name:"subscriptionProductId"}]},{kind:"ScalarField",name:"expiresTime"},{kind:"ScalarField",name:"willCancelAtPeriodEnd"},{kind:"ScalarField",name:"purchaseRevocationReason"},{alias:"yearlyOptions",args:[{kind:"Literal",name:"paidSubscriptionPeriod",value:"yearly"}],concreteType:"SubscriptionProduct",kind:"LinkedField",name:"subscriptionOptions",plural:!0,selections:eP,storageKey:'subscriptionOptions(paidSubscriptionPeriod:"yearly")'},{alias:"monthlyOptions",args:[{kind:"Literal",name:"paidSubscriptionPeriod",value:"monthly"}],concreteType:"SubscriptionProduct",kind:"LinkedField",name:"subscriptionOptions",plural:!0,selections:eP,storageKey:'subscriptionOptions(paidSubscriptionPeriod:"monthly")'}]},{alias:"submitMessageParamsAsDict",args:[{kind:"Literal",name:"gateName",value:"poe_pass_message_params_as_dictionary"}],kind:"ScalarField",name:"booleanGate",storageKey:'booleanGate(gateName:"poe_pass_message_params_as_dictionary")'},{alias:"poeEnableMessageReadReceipts",args:[{kind:"Literal",name:"gateName",value:"poe_enable_message_read_receipts"}],kind:"ScalarField",name:"booleanGate",storageKey:'booleanGate(gateName:"poe_enable_message_read_receipts")'},{alias:"showInteractiveMedia",args:[{kind:"Literal",name:"gateName",value:"poe_enable_user_message_attachments_new_ui"}],kind:"ScalarField",name:"booleanGate",storageKey:'booleanGate(gateName:"poe_enable_user_message_attachments_new_ui")'},{alias:"badgeAtBotMessageCreationEnabled",args:[{kind:"Literal",name:"gateName",value:"poe_badge_at_bot_message_creation"}],kind:"ScalarField",name:"booleanGate",storageKey:'booleanGate(gateName:"poe_badge_at_bot_message_creation")'},{alias:"enableEasierUndoContextClear",args:[{kind:"Literal",name:"gateName",value:"poe_enable_easier_undo_context_clear"}],kind:"ScalarField",name:"booleanGate",storageKey:'booleanGate(gateName:"poe_enable_easier_undo_context_clear")'},{alias:"lastAtMentionEnabled",args:[{kind:"Literal",name:"gateName",value:"poe_add_last_at_mention_to_dropdown"}],kind:"ScalarField",name:"booleanGate",storageKey:'booleanGate(gateName:"poe_add_last_at_mention_to_dropdown")'},{kind:"ScalarField",name:"shouldSeeWebSubscriptionAnnouncement"},b,{alias:"subscribeEnhancedConversionProperties",args:[{kind:"Literal",name:"poePaidAcqEvent",value:"Subscribe"}],kind:"ScalarField",name:"googleTagManagerEnhancedConversionProperties",storageKey:'googleTagManagerEnhancedConversionProperties(poePaidAcqEvent:"Subscribe")'},{alias:"monthlySubscribeEnhancedConversionProperties",args:[{kind:"Literal",name:"poePaidAcqEvent",value:"MonthlySubscribe"}],kind:"ScalarField",name:"googleTagManagerEnhancedConversionProperties",storageKey:'googleTagManagerEnhancedConversionProperties(poePaidAcqEvent:"MonthlySubscribe")'},{alias:"yearlySubscribeEnhancedConversionProperties",args:[{kind:"Literal",name:"poePaidAcqEvent",value:"YearlySubscribe"}],kind:"ScalarField",name:"googleTagManagerEnhancedConversionProperties",storageKey:'googleTagManagerEnhancedConversionProperties(poePaidAcqEvent:"YearlySubscribe")'},{kind:"ScalarField",name:"fileUploadSizeLimits"},{alias:"formattedChatInput",args:[{kind:"Literal",name:"gateName",value:"poe_web_formatted_chat_input"}],kind:"ScalarField",name:"booleanGate",storageKey:'booleanGate(gateName:"poe_web_formatted_chat_input")'},{alias:"useNewPrivacyCheck",args:[{kind:"Literal",name:"gateName",value:"poe_use_script_privacy_check"}],kind:"ScalarField",name:"booleanGate",storageKey:'booleanGate(gateName:"poe_use_script_privacy_check")'}]}]}]}]},params:{id:"b46fbc8570835fa90a9776f9befb95a048d9bc54cf50ef575c645cf1b1aae975",metadata:{},name:"sendMessageMutation",operationKind:"mutation",text:null}});ap.hash="566b4dd4fec174afed1123120af70672",a.default=ap},55525:function(e,a,n){n.r(a);let t={kind:"InlineDataFragment",name:"sendMessage_areSameCanvasTab_canvasTab"};t.hash="4231ccb6d3042772433319b5a0143713",a.default=t},21073:function(e,a,n){n.r(a);let t={kind:"InlineDataFragment",name:"sendMessage_areSameCanvasTab_chat"};t.hash="3ff1936f5e99ea2a2d9587fe3e388d41",a.default=t},9104:function(e,a,n){n.r(a);let t={kind:"InlineDataFragment",name:"sendMessage_bot"};t.hash="2a9987f774db92595c15ae0be510d1df",a.default=t},59966:function(e,a,n){n.r(a);let t={kind:"InlineDataFragment",name:"sendMessage_chat"};t.hash="b88d1b4fb0076695f6d783e445b0bb2b",a.default=t},75594:function(e,a,n){n.r(a);let t={kind:"InlineDataFragment",name:"sendMessage_handleOptimisticTabInNewChat_chat"};t.hash="c6ac405b0febd073bc9c6b76511dabb6",a.default=t},7971:function(e,a,n){n.r(a);let t={kind:"InlineDataFragment",name:"sendMessage_messageAttachment"};t.hash="3516a5654ecab43280472adcd8637c86",a.default=t},94927:function(e,a,n){n.r(a);let t={kind:"InlineDataFragment",name:"sendMessage_newChatUpdater_chat"};t.hash="9166fdbe303e93aca247c845058d956d",a.default=t},5282:function(e,a,n){n.r(a);let t={kind:"InlineDataFragment",name:"sendMessage_onMessageSendChatUpdate_chat"};t.hash="3f09cda2a6e7d19e423600d1197a875f",a.default=t},66937:function(e,a,n){n.r(a);let t={kind:"InlineDataFragment",name:"sendMessage_onMessageSendChatUpdate_messageAttachment"};t.hash="8bcdc0fdf98f584608cee7a0839e5efd",a.default=t},94688:function(e,a,n){n.r(a);let t={kind:"InlineDataFragment",name:"sendMessage_onMessageSendChatUpdate_referencedMessage"};t.hash="b142fee259d36cefb550fbcdcdd4fa2e",a.default=t},55651:function(e,a,n){n.r(a);let t={kind:"InlineDataFragment",name:"sendMessage_onSuccessUpdater_bot"};t.hash="ee4aaef889ad9dfcd7386da3d64786c3",a.default=t},37339:function(e,a,n){n.r(a);let t={kind:"InlineDataFragment",name:"sendMessage_onSuccessUpdater_chat"};t.hash="4b3cb414dd516497247c2268b7a4fd6a",a.default=t},6224:function(e,a,n){n.r(a);let t={kind:"InlineDataFragment",name:"sendMessage_referencedMessage"};t.hash="9ebc9e018fa3af293b07b92dd34eec81",a.default=t},65984:function(e,a,n){n.r(a);let t={kind:"InlineDataFragment",name:"sendMessage_viewer"};t.hash="1cf941bdf9ed6e70272ea7422abecd8d",a.default=t},31657:function(e,a,n){var t=n(67294);let i=t.createContext(null);a.Z=i},30965:function(e,a,n){var t=n(67294);let i=t.createContext(null);a.Z=i},25008:function(e,a,n){n.d(a,{EW:function(){return i},u5:function(){return s},zg:function(){return t}});let t=RegExp("^(?<mention>\\s*@(?<handle>\\S*)\\s?)"),i=/^((\/repeat\s+(\d+)\s*)|(\/compare\s+))?((@\S+\s*)*)@?/,s=RegExp("^(\\/(\\S+)\\s+([^@\\s]+)?(?<trailing_spaces_after_command>\\s*))?((@\\S+(?<trailing_spaces_after_mention>\\s*))*)")},72210:function(e,a,n){n.d(a,{N:function(){return setMessageCreateStatus},R8:function(){return createLocalMessageAttachment},f3:function(){return setMessageState},mH:function(){return createLocalChatMessage}});var t=n(41143),i=n.n(t),s=n(44311);n(43328);let createLocalFile=(e,a)=>{let n=e.get(a.id)||e.create(a.id,"File");return i()("File"===n.getType(),"Expected ".concat(a.id," to be a File, not ").concat(n.getType())),n.setValue(a.id,"id"),n.setValue(a.mimeType,"mimeType"),n.setValue(a.size,"size"),n.setValue(a.height,"height"),n.setValue(a.width,"width"),n.setValue(a.thumbnailUrl,"thumbnailUrl"),n.setValue(a.url,"url"),n},createLocalMessageAttachment=(e,a)=>{let n=e.get(a.id)||e.create(a.id,"MessageAttachment");return i()("MessageAttachment"===n.getType(),"Expected ".concat(a.id," to be an Attachment, not ").concat(n.getType())),n.setValue(a.id,"id"),n.setValue(a.attachmentId,"attachmentId"),n.setValue(a.name,"name"),n.setValue(a.url,"url"),n.setValue(a.localUrl,"localUrl"),n.setValue(a.localMimeType,"localMimeType"),n.setValue(a.isInline,"isInline"),n.setValue(!0,"isOptimistic"),n.setLinkedRecord(createLocalFile(e,a.file),"file"),n},createLocalChatMessage=(e,a)=>{let t=e.get(a.id)||e.create(a.id,"Message");return i()("Message"===t.getType(),"Expected ".concat(a.id," to be a Message, not ").concat(t.getType())),t.setValue(a.id,"id"),t.setValue(a.messageId,"messageId"),t.setValue(a.author,"author"),t.setValue(null,"authorUser"),t.setValue(a.clientNonce,"clientNonce"),t.setValue(a.contentType,"contentType"),t.setValue(a.creationTime,"creationTime"),t.setValue(a.isOptimistic,"isOptimistic"),t.setValue(a.sourceType,"sourceType"),t.setValue(a.state,"state"),t.setValue(a.text,"text"),t.setValue(a.textLengthOnCancellation,"textLengthOnCancellation"),t.setValue(a.timeoutLevel,"timeoutLevel"),t.setValue(a.heartbeatTimeoutLevel,"heartbeatTimeoutLevel"),t.setValue(a.lastUpdatedText,"lastUpdatedText"),t.setLinkedRecords([],"followupActions"),(()=>{if(!a.bot)return t.setValue(null,"bot");{let{id:l}=(0,s.readInlineData)(n(42074),a.bot),r=e.get(l);return i()(r,"Expected bot record ".concat(l," to exist")),t.setLinkedRecord(r,"bot")}})(),t.setValue(a.hasCitations,"hasCitations"),t.setValue(a.createStatus,"createStatus"),t.setValue(a.errorMessage,"errorMessage"),t.setValue(a.messageStateText,"messageStateText"),t.setValue(a.clientMessageStateText||null,"clientMessageStateText"),t.setLinkedRecords(a.attachmentIds.map(a=>e.get(a)).filter(e=>null!=e),"attachments"),(()=>{if(!a.commandType)return t.setValue(null,"command");{let n=e.create(a.id+":command","Command");return n.setValue(a.commandType,"commandType"),t.setLinkedRecord(n,"command")}})(),t.setValue(a.messageCode,""),t.setLinkedRecords([],"reactionCounts"),t.setValue(a.viewerReaction,"viewerReaction"),t.setLinkedRecords([],"usersCanEdit"),t.setLinkedRecords([],"usersCanDelete"),(()=>{if(!a.responsibleJob)return t.setValue(null,"responsibleJob");{let{id:l}=(0,s.readInlineData)(n(52751),a.responsibleJob),r=e.get(l);return i()(r,"Expected job record ".concat(l," to exist")),t.setLinkedRecord(r,"responsibleJob")}})(),(()=>{if(!a.referencedMessageV2)return t.setValue(null,"referencedMessageV2");{let l=(0,s.readInlineData)(n(88928),a.referencedMessageV2),{id:r}=l;if(!r)return t.setValue(null,"referencedMessageV2");let d=e.get(r);return i()(d,"Expected message record ".concat(r," to exist")),t.setLinkedRecord(d,"referencedMessageV2")}})(),t.setValue(a.parameters,"parameters"),t.setValue(a.isChatAnnouncement,"isChatAnnouncement"),t.setValue(a.isEdited,"isEdited"),t.setLinkedRecords([],"recommendedBots"),t},setMessageState=(e,a)=>{i()("Message"===e.getType(),"Cannot set status of record of type ".concat(e.getType())),e.setValue(a,"state")},setMessageCreateStatus=(e,a)=>{i()("Message"===e.getType(),"Cannot set status of record of type ".concat(e.getType())),e.setValue(a,"createStatus")}},26246:function(e,a,n){n.d(a,{Co:function(){return splitSpecialSyntaxAndPrompt},XX:function(){return detectActivelyEditingMention},kJ:function(){return getInvalidMentionedBotsMessage}});var t=n(25008);let i={mention:null,start:0,end:0},getMentionAtPosition=(e,a)=>{let n=e.slice(0,a),t=n.lastIndexOf("@");if(-1===t||/\s/.test(n.slice(t)))return i;let s=e.slice(t),l=/[\s@]/.exec(s.slice(1)),r=t+1,d=l?t+1+l.index:e.length,o=e.slice(r,d);return{mention:o,start:r,end:d}},detectActivelyEditingMention=(e,a,n)=>{if(a!==n)return i;let{mention:s,start:l,end:r}=getMentionAtPosition(e,n),d=t.EW.exec(e);return!d||n>(d.index||0)+(d[0].length||0)?i:{mention:s,start:l,end:r}},getInvalidMentionedBotsMessage=(e,a)=>0===e.length?null:1===(e=e.filter((a,n)=>e.indexOf(a)===n)).length?a('"{{handle}}" does not exist. Check for typos.',{handle:e[0]}):2===e.length?a('"{{handle1}}" and "{{handle2}}" do not exist. Check for typos.',{handle1:e[0],handle2:e[1]}):3===e.length?a('"{{handle1}}", "{{handle2}}", and "{{handle3}}" do not exist. Check for typos.',{handle1:e[0],handle2:e[1],handle3:e[2]}):a('"{{handle1}}", "{{handle2}}", and {{remaining}} others do not exist. Check for typos.',{handle1:e[0],handle2:e[1],remaining:e.length-2}),splitSpecialSyntaxAndPrompt=e=>{var a,n;let i=t.u5.exec(e);if(!i)return{specialSyntax:"",specialSyntaxTrailingSpaces:"",prompt:e};let s=i[0],l=e.slice(s.length),r=null===(a=i.groups)||void 0===a?void 0:a.trailing_spaces_after_command,d=null===(n=i.groups)||void 0===n?void 0:n.trailing_spaces_after_mention;return{specialSyntax:s,prompt:l,specialSyntaxTrailingSpaces:d||r||" "}}},89188:function(e,a,n){n.d(a,{Gx:function(){return createOptimisticHumanMessage},Xw:function(){return createOptimisticCommandMessage},dS:function(){return createOptimisticBotMessage},jH:function(){return createOptimisticMessageAttachment},sC:function(){return createOptimisticChatBreak}});var t=n(41143),i=n.n(t),s=n(44311),l=n(35715),r=n(67280),d=n(83193),o=n(5247),c=n(69388),m=n(45598),u=n(72210);let generateRandomNumber=()=>Math.floor(1e9*Math.random()),generateOptimisticId=(e,a)=>{let n,t;do n=generateRandomNumber(),t="Optimistic-".concat(a,"-").concat(n);while(e.get(t));return[t,n]},createOptimisticMessageAttachment=async(e,a)=>{let n;let t=URL.createObjectURL(a);return(0,s.commitLocalUpdate)(e,e=>{let[i,s]=generateOptimisticId(e,"MessageAttachment"),[l]=generateOptimisticId(e,"File"),r=(0,u.R8)(e,{id:i,attachmentId:s,name:a.name,url:t,localUrl:t,localMimeType:a.type,isInline:!1,isOptimistic:!0,file:{id:l,size:a.size,mimeType:a.type,height:null,thumbnailUrl:null,url:t,width:null}});n=r.getDataID()}),i()((0,m.H)(n),"attachmentId should be a string"),n},createOptimisticHumanMessage=(e,a)=>{let{prompt:n,attachmentIds:t=[],source:i,clientNonce:s,contentType:r,referencedMessage:o}=a,[m,g]=generateOptimisticId(e,"HumanMessage");return(0,u.mH)(e,{id:m,messageId:g,commandType:null,errorMessage:null,attachmentIds:t,author:l.Z.human,clientNonce:s,contentType:r,creationTime:1e3*Date.now(),hasCitations:!1,isOptimistic:!0,sourceType:i.sourceType,state:c.Z.complete,followupActions:[],text:n,textLengthOnCancellation:null,timeoutLevel:0,heartbeatTimeoutLevel:0,lastUpdatedText:n,bot:null,messageStateText:null,clientMessageStateText:null,authorUser:null,messageCode:"",reactionCounts:[],viewerReaction:null,usersCanEdit:[],usersCanDelete:[],responsibleJob:null,referencedMessageV2:null!=o?o:null,parameters:void 0,isChatAnnouncement:!1,isEdited:!1,createStatus:d.Z.success})},createOptimisticBotMessage=(e,a)=>{let{bot:t,contentType:i,text:l="",state:r=c.Z.incomplete}=a,{nickname:d,...m}=(0,s.readInlineData)(n(10145),t),[g,p]=generateOptimisticId(e,"BotMessage");return(0,u.mH)(e,{id:g,messageId:p,attachmentIds:[],commandType:null,errorMessage:null,author:d,clientNonce:null,contentType:i,creationTime:1e3*Date.now(),hasCitations:!1,isOptimistic:!0,sourceType:o.Z.chat_input,state:r,followupActions:[],text:l,textLengthOnCancellation:null,timeoutLevel:0,heartbeatTimeoutLevel:0,lastUpdatedText:l,bot:m,messageStateText:null,clientMessageStateText:null,authorUser:null,messageCode:"",reactionCounts:[],viewerReaction:null,usersCanEdit:[],usersCanDelete:[],responsibleJob:null,referencedMessageV2:null,parameters:void 0,isChatAnnouncement:!1,isEdited:!1,createStatus:null})},createOptimisticChatBreak=(e,a)=>{let{clientNonce:n}=a,[t,i]=generateOptimisticId(e,"ChatBreakMessage");return(0,u.mH)(e,{id:t,messageId:i,attachmentIds:[],author:l.Z.chat_break,clientNonce:n,contentType:r.Z.text_plain,creationTime:1e3*Date.now(),hasCitations:!1,commandType:null,errorMessage:null,isOptimistic:!0,sourceType:o.Z.chat_input,state:c.Z.complete,followupActions:[],text:"",textLengthOnCancellation:null,timeoutLevel:0,heartbeatTimeoutLevel:0,lastUpdatedText:"",bot:null,messageStateText:null,clientMessageStateText:null,authorUser:null,messageCode:"",reactionCounts:[],viewerReaction:null,usersCanEdit:[],usersCanDelete:[],responsibleJob:null,referencedMessageV2:null,parameters:void 0,isChatAnnouncement:!1,isEdited:!1,createStatus:null})},createOptimisticCommandMessage=(e,a)=>{let{clientNonce:n,text:t,commandType:i}=a,[s,d]=generateOptimisticId(e,"CommandMessage");return(0,u.mH)(e,{id:s,messageId:d,attachmentIds:[],author:l.Z.command,clientNonce:n,contentType:r.Z.text_plain,creationTime:1e3*Date.now(),hasCitations:!1,isOptimistic:!0,sourceType:o.Z.chat_input,state:c.Z.complete,followupActions:[],errorMessage:null,text:t,textLengthOnCancellation:null,heartbeatTimeoutLevel:0,timeoutLevel:0,lastUpdatedText:t,bot:null,commandType:i,messageStateText:null,clientMessageStateText:null,authorUser:null,messageCode:"",reactionCounts:[],viewerReaction:null,usersCanEdit:[],usersCanDelete:[],responsibleJob:null,referencedMessageV2:null,parameters:void 0,isChatAnnouncement:!1,isEdited:!1,createStatus:null})}},43518:function(e,a,n){n.d(a,{$:function(){return generatePresignedUrls},K:function(){return uploadFilesToPresignedUrls}});var t,i,s,l,r=n(22578);(t=s||(s={})).success="success",t.rate_limited="rate_limited";var d=s;let o=n(86294),generatePresignedUrls=async(e,a,n,t)=>{let i=await new Promise(i=>(0,r.commitMutation)(a,{mutation:o,variables:{fileInfos:e},onCompleted:e=>{e.generatePresignedUrls.status===d.success?i(e.generatePresignedUrls.presignedUrls):e.generatePresignedUrls.status===d.rate_limited?t(Error("File upload rate limited"),n("You have uploaded too many files recently. Please try again later.")):t(Error("File upload failed"),n("Server error"))},onError:e=>{t(e,n("File upload failed"))}}));return i};(i=l||(l={})).missingPresignedUrl="missingPresignedUrl",i.uploadFailed="uploadFailed",i.rejected="rejected";let uploadFilesToPresignedUrls=async(e,a,n)=>{let t=Array.from(e.entries()),i=await Promise.allSettled(t.map(async e=>{let[a,n]=e,t=await fetch(a,{method:"PUT",body:n,headers:{"Content-Type":n.type}});return t.ok?{filename:n.name,success:!0,url:a}:{filename:n.name,success:!1,errorType:"uploadFailed"}})),s=i.map((e,a)=>"rejected"===e.status?{filename:t[a][1].name,type:"rejected"}:"fulfilled"!==e.status||e.value.success?null:{filename:e.value.filename,type:e.value.errorType}).filter(e=>null!==e);if(s.length>0){let e=new Map;s.forEach(a=>{let n=e.get(a.type)||[];n.push(a.filename),e.set(a.type,n)});let t=n("Failed to upload: {{fileList}}",{fileList:s.map(e=>e.filename).join(", ")});a(Error(t),t)}return s}},81759:function(e,a,n){n.d(a,{Mo:function(){return clearNonce},Us:function(){return useResendMessage},gc:function(){return setNonceArgs}});var t=n(41143),i=n.n(t),s=n(67294),l=n(22120),r=n(22578),d=n(44311),o=n(8583),c=n(27664),m=n(28871);let u=new Map,getArgs=e=>{let a=u.get(e);if(!a)throw Error("No args for nonce ".concat(e));return a},setNonceArgs=(e,a)=>u.set(e,a),clearNonce=e=>u.delete(e),resendMessage=e=>{let{environment:a,message:t,bot:s,chat:l,viewer:r,setToast:o,onSuccessfulMessageSend:u,t:g,referencedMessage:p}=e,{id:k,isOptimistic:_,clientNonce:h}=(0,d.readInlineData)(n(40273),t),b=(0,d.readInlineData)(n(21049),l),F=(0,d.readInlineData)(n(89340),s),f=(0,d.readInlineData)(n(71883),r);i()(_&&h,"Message must be optimistic to resend");let{optimisticUpdate:y,...S}=getArgs(h);(0,d.commitLocalUpdate)(a,e=>{let a=e.get(b.id);i()(a,"Expected chat record ".concat(b.id," to exist")),(0,c.T5)(a,k)}),a.revertUpdate(y),(0,m.bG)({environment:a,chat:b,bot:F,viewer:f,setToast:o,onSuccessfulMessageSend:u,t:g,referencedMessage:p,...S})},useResendMessage=e=>{let{message:a,chat:n,bot:t,viewer:i,referencedMessage:d}=e,c=(0,r.useRelayEnvironment)(),m=(0,o.ZP)(),{t:u}=(0,l.$G)();return(0,s.useCallback)(function(){let{onSuccessfulMessageSend:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};resendMessage({environment:c,message:a,bot:t,chat:n,viewer:i,setToast:m,onSuccessfulMessageSend:a=>{null==e||e(a)},t:u,referencedMessage:d})},[c,m,a,t,n,i,u,d])}},28871:function(e,a,n){n.d(a,{j:function(){return newChatUpdater},A6:function(){return prepareUploadables},bG:function(){return sendMessage},$3:function(){return useSendMessage}});var t=n(41143),i=n.n(t),s=n(67294),l=n(22120),r=n(22578),d=n(8583),o=n(42093),c=n(52069),m=n(74285),u=n(6940),g=n(99391),p=n(45598),k=n(83193),_=n(69388),h=n(46245),b=n(50311),F=n(89582),f=n(20761),y=n(29915),S=n(57403),M=n(53236),v=n(44311),T=n(67280),chat_getChatContentType=e=>{let{defaultBotObject:a}=(0,v.readInlineData)(n(45482),e);return a.hasMarkdownRendering?T.Z.text_markdown:T.Z.text_plain},C=n(24487),L=n(60911),I=n(72210),w=n(27664),U=n(89188),P=n(43518),x=n(81759),A=n(41580);let prepareUploadables=e=>{if(!e)return[{},[]];let a=Array.from(e).reduce((e,a,n)=>({...e,["file".concat(n)]:a}),{});return[a,Array.from(Object.keys(a))]},areTheSameCanvasTab=(e,a,t)=>{let i=(0,r.readInlineData)(n(21073),a),s=(0,r.readInlineData)(n(55525),t);return e.__typename===s.__typename&&"BotCanvasTab"===e.__typename&&"botId"in s&&1==i.canvasTabsConnection.edges.length&&e.botId===s.botId},E=n(57868),sendMessage=async e=>{let{environment:a,bot:t,chat:s,viewer:l,prompt:d,source:u,files:_=[],existingAttachments:h=[],setToast:y,onSuccessfulMessageSend:S=()=>{},referencedMessage:v,parameters:T,onFailedMessageSend:I=()=>{},clientNonce:w,updateChatHistory:U=!0,onError:D,t:N}=e;(0,g.Si)();let V=(0,m.h0)(),{id:O,chatId:B,isOptimistic:R,defaultBotObject:K,...G}=(0,r.readInlineData)(n(59966),s);R&&(0,f.WK)();let H=(0,r.readInlineData)(n(9104),t),j=(0,r.readInlineData)(n(6224),v||null),z=h.map(e=>(0,r.readInlineData)(n(7971),e)),{shouldUseFinishUploadEndpoint:J,shouldUsePresignedUrl:q,useMessageSendingIcon:Z}=(0,r.readInlineData)(n(65984),l),W=w||(0,M.C)(),Q={storeUpdater:e=>{!R&&U&&(0,L.x6)(e,O,K.handle),(0,o.A7)(e,H.id)}};(0,x.gc)(W,{prompt:d,files:_,source:u,optimisticUpdate:Q}),(0,C.Gy)(W);let{optimisticHumanMessageId:Y,optimisticHumanMessageEdgeId:$}=await onMessageSendChatUpdate({environment:a,chat:G,existingAttachments:z,prompt:d,files:_,source:u,clientNonce:W,referencedMessage:j}),onMessageSendError=(e,n)=>{(0,C.V8)(W),(0,r.commitLocalUpdate)(a,e=>{onSendFailureUpdater(e,{chatNodeId:O,optimisticHumanMessageEdgeId:$,errorMessage:window.navigator.onLine?n||N("Message failed to send."):N("Unable to send this message. Check your internet connection.")})}),(0,f.U3)(5e3),null==D||D(e)},[X,ee]=prepareUploadables(_),ea=await Promise.all(ee.map(async e=>({contentType:X[e].type,fileHash:await (0,b.B)(X[e]),name:X[e].name})));if(q){let e=await (0,P.$)(ea.map(e=>({fileHash:e.fileHash,contentType:e.contentType})),a,N,onMessageSendError),n=await (0,P.K)(new Map(e.map((e,a)=>[e,_[a]])),onMessageSendError,N);if(n.length>0)return}let en=[];if(J&&X){let{success:e,tokens:n}=await (0,A.qY)({uploadablesAndAttachmentsOrFileInfo:q?ea:{uploadables:X,attachments:ee},onProgress:Z?void 0:e=>{(0,A.yo)(a,$,e,N)},onPartialError:()=>{(0,A.xJ)(a,$)},onComplete:e=>{if((0,A.H)(a,$),!e.every(e=>e.success)){let a=e.filter(e=>!e.success),n=new Map;a.forEach(e=>{n.has(e.error)||n.set(e.error,[]),n.get(e.error).push(e.filename)});let t=Array.from(n.entries()).map(e=>{let[a,n]=e;return N("{{errorMessage}}: {{filenames}}",{errorMessage:a,filenames:n.join(", ")})}).join(" ");onMessageSendError(Error("Failed to upload files"),t)}}});if(!e)return;(0,A.H)(a,$),en=n}let et=await V;a.applyUpdate(Q);let ei=T?JSON.stringify(T):void 0;(0,F.DU)(d,B,!0),(0,r.commitMutation)(a,{mutation:E,variables:{chatId:R?null:B,shouldFetchChat:!!R,bot:K.handle,query:d,source:u,clientNonce:W,attachments:ee,existingMessageAttachmentsIds:z.map(e=>e.attachmentId),sdid:et,referencedMessageId:null==j?void 0:j.messageId,parameters:ei,fileHashJwts:en},uploadables:J?null:X,updater:(e,n)=>{var t,i,s,l,r;if((null==n?void 0:null===(t=n.messageEdgeCreate)||void 0===t?void 0:t.status)===k.Z.success&&(null==n?void 0:null===(i=n.messageEdgeCreate)||void 0===i?void 0:i.message)){onSendSuccessUpdater(e,a,{bot:n.messageEdgeCreate.bot,chat:G,optimisticHumanMessageEdgeId:$,messageData:n.messageEdgeCreate.message.node,botMessageData:null===(s=n.messageEdgeCreate.botMessage)||void 0===s?void 0:s.node,jobData:n.messageEdgeCreate.job,createStatus:n.messageEdgeCreate.status});let t=n.messageEdgeCreate.chat,i=n.messageEdgeCreate.bot;R&&t&&i&&newChatUpdater(e,{chat:t,optimisticChatId:O});let l=K.handle;n.messageEdgeCreate.chat&&U?((0,L.eM)(e,O),(0,L.x6)(e,n.messageEdgeCreate.chat.id,l)):U&&(0,L.x6)(e,O,l),(0,o.A7)(e,H.id)}else(0,C.V8)(W),onSendFailureUpdater(e,{chatNodeId:O,optimisticHumanMessageEdgeId:$,errorMessage:null==n?void 0:null===(l=n.messageEdgeCreate)||void 0===l?void 0:l.statusMessage,createStatus:null==n?void 0:null===(r=n.messageEdgeCreate)||void 0===r?void 0:r.status})},onCompleted:e=>{a.revertUpdate(Q);let n=onSendMessageCompleted(e,y,Y,W);n?S(e):I(e),(0,f.U3)(5e3)},onError:onMessageSendError}),i()((0,p.h)(Y),"Expected optimistic human message id to be a number"),(0,c.CE)(Y,B)},onMessageSendChatUpdate=async e=>{let a,t,{environment:s,chat:l,prompt:d,files:o,existingAttachments:c,source:m,clientNonce:u,referencedMessage:g}=e,{id:k,..._}=(0,r.readInlineData)(n(5282),l),h=c.map(e=>(0,r.readInlineData)(n(66937),e).id),b=(0,r.readInlineData)(n(94688),g||null),F=await Promise.all(o.map(e=>(0,U.jH)(s,e))),f=chat_getChatContentType(_);return(0,r.commitLocalUpdate)(s,e=>{let n=e.get(k);i()(n,"Expected Chat record with id ".concat(k," to exist when sending a message"));let s=(0,U.Gx)(e,{prompt:d,referencedMessage:b,attachmentIds:[...h,...F],source:m,clientNonce:u,contentType:f}),l=(0,w.n3)(e,n,s);a=l.getDataID(),t=s.getValue("messageId")}),i()((0,p.h)(t),"Expected optimistic human message id to be a number"),i()(a,"Expected optimistic human message edge id to exist"),{optimisticHumanMessageId:t,optimisticHumanMessageEdgeId:a}},onSendMessageCompleted=(e,a,n,t)=>{let s=e.messageEdgeCreate.status;if(s!==k.Z.success)return!1;let l=getErrorMessageFromFailedUrls(e.messageEdgeCreate.failedUrls);return l&&a({type:d.pC.error,content:l}),i()(e.messageEdgeCreate.message,"No message on a successful send message mutation"),(0,c.Ot)(n,e.messageEdgeCreate.message.node.messageId),(0,x.Mo)(t),!0},getErrorMessageFromFailedUrls=e=>{if(0===e.length)return null;let a=e[0].reason;if(1===e.length)switch(a){case"fetch_error":return"Failed to fetch ".concat(e[0].url," because of a problem crawling the URL.");case"over_budget":return"Failed to fetch ".concat(e[0].url," because it was too large. Please keep crawled web pages to <100 MB total.");case"unsupported_content_type":return"Failed to fetch ".concat(e[0].url," because it was not a supported content type.");default:return"Failed to fetch ".concat(e[0].url,".")}switch(a){case"fetch_error":return"Failed to fetch ".concat(e.length," urls because of problems crawling them.");case"over_budget":return"Failed to fetch ".concat(e.length," urls because they were too large. Please keep crawled web pages to <100 MB total.");case"unsupported_content_type":return"Failed to fetch ".concat(e.length," urls because of unsupported content types.");default:return"Failed to fetch ".concat(e.length," urls.")}},onSendSuccessUpdater=(e,a,t)=>{let{bot:s,chat:l,optimisticHumanMessageEdgeId:d,messageData:o,botMessageData:c,jobData:m,createStatus:u}=t,{id:g}=(0,r.readInlineData)(n(37339),l),p=(0,r.readInlineData)(n(55651),s),k=e.get(g),_=e.get(d);i()(k,"Expected Chat record with id ".concat(g," to exist when sending a message"));let h=(0,w.rN)(e,o);(0,I.N)(h,u);let b=(0,w.kz)(e,k,_,h);if(c){(0,C.OE)(c.messageId.toString(),{source:"sendMessage",botId:p.botId});let a=(0,w.Ey)(k);(null==a?void 0:a.getDataID())===(null==h?void 0:h.getDataID())||(null==a?void 0:a.getValue("isOptimistic"))?(0,w.OJ)(e,k,c,b):(0,w.OJ)(e,k,c)}if(m){let handleJobTimeout=(e,n)=>{(0,r.commitLocalUpdate)(a,a=>{(0,S.Z)(a,e,n,()=>{(0,w.Cc)(a,n)})})};(0,C.QX)(m.jobId.toString(),{source:"sendMessage"},()=>handleJobTimeout(m.id,g)),(0,y.Z)(e,m.id,g)}},newChatUpdater=(e,a)=>{let{chat:t,optimisticChatId:s}=a,l=(0,r.readInlineData)(n(94927),t);(0,u.mK)(l.chatId,s);let d=e.get(l.id);i()(d,"Cannot find chat record with id ".concat(l.id)),e.getRoot().setLinkedRecord(d,"chatOfCode",{chatCode:l.chatCode}),function(e,a,t){let i=(0,r.readInlineData)(n(75594),e),s=i.canvasTabInForeground;if(!s)return;let l=function(e,a){let n=e.get(a);if(!n)return null;let t=n.getLinkedRecord("canvasTabInForeground");if(!t)return null;let i=t.getDataID(),s=t.getValue("__typename"),l=t.getValue("botId");return"number"!=typeof l||"string"!=typeof s?null:{id:i,__typename:s,botId:l}}(t,a);l&&areTheSameCanvasTab(l,i,s)&&(0,h.PY)(t,s.id,l.id)}(l,s,e)},onSendFailureUpdater=(e,a)=>{var n;let{chatNodeId:t,optimisticHumanMessageEdgeId:s,errorMessage:l,createStatus:r}=a,d=e.get(t),o=null===(n=e.get(s))||void 0===n?void 0:n.getLinkedRecord("node");i()(d,"Expected Chat record with id ".concat(t," to exist when sending a message")),i()(o,"Expected optimistic human message to exist after sending a message"),(0,I.f3)(o,_.Z.error),(0,I.N)(o,r),o.setValue(l,"errorMessage")},useSendMessage=e=>{let{source:a,bot:n,chat:t,viewer:i,referencedMessage:o}=e,c=(0,r.useRelayEnvironment)(),m=(0,d.ZP)(),{t:u}=(0,l.$G)(),g=(0,s.useCallback)(async e=>{let{prompt:s,parameters:l,files:r,existingAttachments:d,source:g,onSuccessfulMessageSend:p,clientNonce:k}=e;return await sendMessage({environment:c,bot:n,chat:t,viewer:i,prompt:s,files:r,existingAttachments:d,source:g||a,setToast:m,onSuccessfulMessageSend:e=>{null==p||p(e)},referencedMessage:o,parameters:l,clientNonce:k,t:u})},[n,t,i,c,m,a,u,o]);return g}},41580:function(e,a,n){n.d(a,{H:function(){return clearUploadProgress},qY:function(){return handleUploads},xJ:function(){return updateMessageStateToError},yo:function(){return updateMessageUploadProgress}});var t=n(44311),i=n(69388),s=n(87063);let finishUpload=async e=>{let a=new FormData;e instanceof File?a.append("file",e):(a.append("file_hash",e.fileHash),a.append("filename",e.name),a.append("content_type",e.contentType));let n=await (0,s.Mz)(),t=await fetch("/api/finish_upload_POST",{method:"POST",body:a,headers:{"poe-formkey":n},credentials:"include"});if(!t.ok)throw Error("Upload finalization failed; Request Error");return await t.json()},handleUploads=async e=>{let{uploadablesAndAttachmentsOrFileInfo:a,onProgress:n=()=>{},onPartialError:t=()=>{},onComplete:i=()=>{}}=e,s=!Array.isArray(a);if(s){let{uploadables:e,attachments:s}=a;if(!e||0===Object.keys(e).length)return{success:!0,tokens:[]};let l=s.map(a=>e[a]);return await processUploads({items:l.map(e=>({file:e,filename:e.name})),onProgress:n,onPartialError:t,onComplete:i})}return a&&0!==a.length?await processUploads({items:a.map(e=>({fileInfo:e,filename:e.name})),onProgress:n,onPartialError:t,onComplete:i}):{success:!0,tokens:[]}},processUploads=async e=>{let{items:a,onProgress:n,onPartialError:t,onComplete:i}=e,s=!1,l=new Map,computeResultsFromMap=()=>Array.from(l.entries()).sort((e,a)=>{let[n]=e,[t]=a;return n-t}).map(e=>{let[,a]=e;return a}),handleError=(e,a,n)=>{let i={filename:e,success:!1,error:a};return l.set(n,i),s=!0,t(e,a),i};n({completed:0,total:a.length,results:[]}),await Promise.allSettled(a.map(async(e,t)=>{try{let i=await finishUpload("file"in e?e.file:e.fileInfo);if("success"!==i.status)return handleError(e.filename,i.message,t);{let s={filename:e.filename,success:!0,token:i.token};return l.set(t,s),n({completed:l.size,total:a.length,results:computeResultsFromMap()}),s}}catch(n){let a=n instanceof Error?n.message:"Unknown error";return handleError(e.filename,a,t)}}));let r=computeResultsFromMap();i(r);let d=r.map(e=>(null==e?void 0:e.success)?e.token:void 0).filter(e=>void 0!==e);return{success:!s,tokens:d}},clearUploadProgress=(e,a)=>{(0,t.commitLocalUpdate)(e,e=>{let n=e.get(a),t=null==n?void 0:n.getLinkedRecord("node");t&&t.setValue(null,"clientMessageStateText")})},updateMessageUploadProgress=(e,a,n,i)=>{(0,t.commitLocalUpdate)(e,e=>{let t=e.get(a),s=null==t?void 0:t.getLinkedRecord("node");if(s){let e=i("uploadProgressText",{completed:Math.min(n.completed+1,n.total),total:n.total,count:n.total,defaultValue:"Processing {{completed}}/{{total}} files...",defaultValue_one:"Processing {{completed}}/{{total}} file..."});s.setValue(e,"clientMessageStateText")}})},updateMessageStateToError=(e,a)=>{(0,t.commitLocalUpdate)(e,e=>{let n=e.get(a),t=null==n?void 0:n.getLinkedRecord("node");t&&t.setValue(i.Z.error,"state")})}},50311:function(e,a,n){function preloadFile(e){if(!FileReader||0!==e.size)return;let a=new FileReader;a.onload=()=>{},a.readAsBinaryString(e)}n.d(a,{B:function(){return calculateFileHash},a:function(){return preloadFile}});let calculateFileHash=async e=>{let a;if(e.size<5242880){let n=await e.arrayBuffer();a=await crypto.subtle.digest("SHA-256",n)}else{let n=e.slice(0,1048576),t=e.slice(Math.max(0,e.size-1048576),e.size),[i,s]=await Promise.all([n.arrayBuffer(),t.arrayBuffer()]),l=new Uint8Array(i),r=new Uint8Array(s),d="".concat(e.name,"-").concat(e.size,"-").concat(e.lastModified,"-").concat(e.type),o=new TextEncoder,c=o.encode(d),m=new Uint8Array(l.length+c.length+r.length);m.set(l,0),m.set(c,l.length),m.set(r,l.length+c.length),a=await crypto.subtle.digest("SHA-256",m)}let n=Array.from(new Uint8Array(a));return n.map(e=>e.toString(16).padStart(2,"0")).join("")}},89582:function(e,a,n){n.d(a,{DU:function(){return setLastAtMention},ed:function(){return getLastAtMention},rw:function(){return isLastAtMention}});var t=n(26246);let i=new Map,getLastAtMentionFromMessage=e=>{let{specialSyntax:a}=(0,t.Co)(e||""),n=a.match(/@([^\s@]+)/g),i=getMentionString(n),s=null==n?void 0:n.join(" ");return{mention:i,mentionWithAt:s=(null==s?void 0:s.startsWith("@"))?s.slice(1):s}},getMentionString=e=>{let a=null==e?void 0:e.map(e=>e.replace("@","")).join(", ");return a&&a.length>50&&(a=a.slice(0,50)+"..."),a};function setLastAtMention(e,a){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(!e||!a||!n)return;let{mention:t,mentionWithAt:s}=getLastAtMentionFromMessage(e);t&&s&&i.set(a,{chatId:a,mention:t,mentionWithAt:s})}function getLastAtMention(e,a){if(a)return i.get(e)}let isLastAtMention=e=>!!e&&"mention"in e},67280:function(e,a){var n,t;(t=n||(n={})).text_markdown="text_markdown",t.text_plain="text_plain",a.Z=n},83193:function(e,a){var n,t;(t=n||(n={})).success="success",t.success_continue_chat_from_share_message_limit_exceeded="success_continue_chat_from_share_message_limit_exceeded",t.no_access="no_access",t.too_many_tokens="too_many_tokens",t.reached_limit="reached_limit",t.bot_is_down="bot_is_down",t.exception="exception",t.rate_limit_exceeded="rate_limit_exceeded",t.unsupported_file_type="unsupported_file_type",t.file_too_large="file_too_large",t.file_not_accessible="file_not_accessible",t.input_empty="input_empty",t.multiple_files_unsupported="multiple_files_unsupported",t.invalid_file_type_combination="invalid_file_type_combination",t.multiple_video_files="multiple_video_files",t.message_points_display_price_mismatch="message_points_display_price_mismatch",t.mentioned_bot_does_not_exist="mentioned_bot_does_not_exist",t.multiple_image_files_unsupported="multiple_image_files_unsupported",t.image_attachment_number_exceeeded="image_attachment_number_exceeeded",t.attachment_file_number_exceeded="attachment_file_number_exceeded",t.unprocessable_file="unprocessable_file",t.concurrent_messages="concurrent_messages",t.bot_does_not_support_file_upload="bot_does_not_support_file_upload",t.total_file_size_limit_exceeded="total_file_size_limit_exceeded",t.bot_requests_per_message_limit_exceeded="bot_requests_per_message_limit_exceeded",t.command_does_not_exist="command_does_not_exist",t.bad_command_arg="bad_command_arg",t.bad_command_prompt="bad_command_prompt",t.canvas_app_cannot_access_private_bot="canvas_app_cannot_access_private_bot",t.compare_message_not_found="compare_message_not_found",t.private_bot_access_denied="private_bot_access_denied",t.invalid_parameters_dictionary="invalid_parameters_dictionary",a.Z=n},5247:function(e,a){var n,t;(t=n||(n={})).welcome_topic="welcome_topic",t.linked_phrase="linked_phrase",t.suggested_reply="suggested_reply",t.chat_input="chat_input",t.continue_conversation="continue_conversation",t.quora_machine_answer_interaction="quora_machine_answer_interaction",t.quora_ask_new_question_interaction="quora_ask_new_question_interaction",t.conversation_starter="conversation_starter",t.resend_followup="resend_followup",t.home_page_conversation_starter="home_page_conversation_starter",t.cross_bot_chat_input="cross_bot_chat_input",t.in_chat_bot_recommendation="in_chat_bot_recommendation",t.animate="animate",t.upscale="upscale",t.preview_triggered="preview_triggered",t.executable_codeblock="executable_codeblock",t.speak_text="speak_text",t.revoice="revoice",t.compare="compare",t.multiple_call_chat_input="multiple_call_chat_input",t.repeat_followup="repeat_followup",t.summarize="summarize",a.Z=n}}]);