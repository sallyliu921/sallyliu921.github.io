(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5402],{36411:function(e,t,n){"use strict";var a,i=n(67294);function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}t.Z=function(e){return i.createElement("svg",_extends({viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e),a||(a=i.createElement("path",{d:"M19 21.5H5a1 1 0 0 1-1-1v-17a1 1 0 0 1 1-1h8a.995.995 0 0 1 .675.262l.032.031 6 6 .031.032.001.001A1 1 0 0 1 20 9.5v11a1 1 0 0 1-1 1Zm-13-2h12v-9h-5a1 1 0 0 1-1-1v-5H6v15Zm8-11h2.586L14 5.914V8.5Z"})))}},35831:function(e,t,n){"use strict";var a,i=n(67294);function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}t.Z=function(e){return i.createElement("svg",_extends({viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e),a||(a=i.createElement("path",{d:"M19.5 3.5h-15C2.57 3.5 1 5.07 1 7v10c0 1.93 1.57 3.5 3.5 3.5h15c1.93 0 3.5-1.57 3.5-3.5V7c0-1.93-1.57-3.5-3.5-3.5ZM21 7v1.5h-2v-3h.5c.827 0 1.5.673 1.5 1.5Zm-4 4H7V5.5h10V11ZM5 13.5H3v-3h2v3Zm2-.5h10v5.5H7V13Zm12-2.5h2v3h-2v-3Zm-14.5-5H5v3H3V7c0-.827.673-1.5 1.5-1.5ZM3 17v-1.5h2v3h-.5c-.827 0-1.5-.673-1.5-1.5Zm16.5 1.5H19v-3h2V17c0 .827-.673 1.5-1.5 1.5Z"})))}},74214:function(e,t,n){"use strict";n.r(t);let a={argumentDefinitions:[],kind:"Fragment",name:"FileInfo_GenericFileInfo_attachment",selections:[{kind:"FragmentSpread",name:"FileInfo_useName_attachment"},{kind:"FragmentSpread",name:"FileInfo_useMimeType_attachment"},{kind:"FragmentSpread",name:"FileInfo_useUrl_attachment"},{kind:"FragmentSpread",name:"FileInfo_useSize_attachment"},{kind:"FragmentSpread",name:"FileInfo_useIsLoading_messageAttachment"}],type:"Attachment",abstractKey:"__isAttachment"};a.hash="86cf4a30ad884b1eaada9fdb947967f4",t.default=a},40849:function(e,t,n){"use strict";n.r(t);let a={argumentDefinitions:[],kind:"Fragment",name:"FileInfo_ImageInfo_attachment",selections:[{kind:"FragmentSpread",name:"FileInfo_useName_attachment"},{kind:"FragmentSpread",name:"FileInfo_useDisplayUrl_attachment"}],type:"Attachment",abstractKey:"__isAttachment"};a.hash="71bb18642c04ba9fb407743497d77ff9",t.default=a},97702:function(e,t,n){"use strict";n.r(t);let a={argumentDefinitions:[],kind:"Fragment",name:"FileInfo_attachment",selections:[{kind:"FragmentSpread",name:"FileInfo_useMimeType_attachment"},{kind:"FragmentSpread",name:"FileInfo_GenericFileInfo_attachment"},{kind:"FragmentSpread",name:"FileInfo_ImageInfo_attachment"}],type:"Attachment",abstractKey:"__isAttachment"};a.hash="b929cc33574e7123fb2b38376f100621",t.default=a},76810:function(e,t,n){"use strict";n.r(t);let a={argumentDefinitions:[],kind:"Fragment",name:"FileInfo_useDisplayUrl_attachment",selections:[{kind:"FragmentSpread",name:"FileInfo_useUrl_attachment"},{kind:"ClientExtension",selections:[{kind:"ScalarField",name:"localUrl"}]}],type:"Attachment",abstractKey:"__isAttachment"};a.hash="f4666f1ed84fa76ff32cdea3cf17fb0d",t.default=a},80874:function(e,t,n){"use strict";n.r(t);let a={argumentDefinitions:[],kind:"Fragment",name:"FileInfo_useIsLoading_messageAttachment",selections:[{kind:"ClientExtension",selections:[{kind:"ScalarField",name:"isOptimistic"}]}],type:"MessageAttachment"};a.hash="6098b79cd856b6e809188cbe96e59d11",t.default=a},21558:function(e,t,n){"use strict";n.r(t);let a={argumentDefinitions:[],kind:"Fragment",name:"FileInfo_useMimeType_attachment",selections:[{concreteType:"File",kind:"LinkedField",name:"file",plural:!1,selections:[{kind:"ScalarField",name:"mimeType"}]}],type:"Attachment",abstractKey:"__isAttachment"};a.hash="72c9f77a03b034ddde99b734afc3570f",t.default=a},8205:function(e,t,n){"use strict";n.r(t);let a={argumentDefinitions:[],kind:"Fragment",name:"FileInfo_useName_attachment",selections:[{kind:"ScalarField",name:"name"}],type:"Attachment",abstractKey:"__isAttachment"};a.hash="3d7c6e009705079c358a3fe4ae27e326",t.default=a},32515:function(e,t,n){"use strict";n.r(t);let a={argumentDefinitions:[],kind:"Fragment",name:"FileInfo_useSize_attachment",selections:[{concreteType:"File",kind:"LinkedField",name:"file",plural:!1,selections:[{kind:"ScalarField",name:"size"}]}],type:"Attachment",abstractKey:"__isAttachment"};a.hash="bb68e0a5ab9e1b762d5adf7c3ba2c952",t.default=a},49778:function(e,t,n){"use strict";n.r(t);let a={argumentDefinitions:[],kind:"Fragment",name:"FileInfo_useUrl_attachment",selections:[{kind:"ScalarField",name:"url"}],type:"Attachment",abstractKey:"__isAttachment"};a.hash="d96d0e0cb3c06b0a75db717b2ee05226",t.default=a},52985:function(e,t,n){"use strict";n.r(t);let a={argumentDefinitions:[],kind:"Fragment",name:"FileInfo_viewer",selections:[{alias:"enableImageAttachmentsForBots",args:[{kind:"Literal",name:"gateName",value:"poe_enable_image_attachments_for_bots"}],kind:"ScalarField",name:"booleanGate",storageKey:'booleanGate(gateName:"poe_enable_image_attachments_for_bots")'}],type:"Viewer"};a.hash="1cddcd179b0f724535aa9d8c18c36994",t.default=a},28333:function(e,t,n){"use strict";n.r(t);let a={argumentDefinitions:[],kind:"Fragment",name:"useFileUpload_bot",selections:[{kind:"ScalarField",name:"botId"},{kind:"ScalarField",name:"uploadFileSizeLimit"}],type:"Bot"};a.hash="ce06a75626a42db2438fcf216e8fd93e",t.default=a},70827:function(e,t,n){"use strict";n.r(t);let a={kind:"InlineDataFragment",name:"useFileUpload_chat"};a.hash="93a66caca5202b6acf1ddbf20f156c46",t.default=a},16641:function(e,t,n){"use strict";n.r(t);let a={argumentDefinitions:[],kind:"Fragment",name:"useFileUpload_viewer",selections:[{kind:"ScalarField",name:"fileUploadSizeLimits"},{alias:"enableFileSizeLimitsByFileType",args:[{kind:"Literal",name:"gateName",value:"poe_enable_file_size_limits_by_file_type"}],kind:"ScalarField",name:"booleanGate",storageKey:'booleanGate(gateName:"poe_enable_file_size_limits_by_file_type")'}],type:"Viewer"};a.hash="104bd457a40bf1b4a957d88d6bf4687e",t.default=a},61134:function(e,t,n){"use strict";n.d(t,{$8:function(){return MessageAttachmentsProvider},ZP:function(){return inputFooter_useFileUpload},uy:function(){return parseMimeType},cy:function(){return useMessageAttachments}});var a=n(85893),i=n(67294),r=n(22120),l=n(22578),s=n(21054),o=n(94282),c=n(9729),u=n(30038),m=n(96384);let getFileSizeErrorMessage=(e,t,n,a,i,r)=>{let[l,s]=(0,o.w)(a);return e?t?r("Attachments of type {{typeDisplayName, string}} must be {{limit, number}} or smaller.",{typeDisplayName:n,limit:l,style:"unit",unit:s,unitDisplay:"short"}):r("The combined size of all attachments must be {{limit, number}} or smaller.",{limit:l,style:"unit",unit:s,unitDisplay:"short"}):0==l?r("The bot you are trying to chat with does not accept attachments."):i<=1?r("The file you tried to attach is too large. Please try uploading a file that is less than {{limit, number}}.",{limit:l,style:"unit",unit:s,unitDisplay:"short"}):i>1?r("The files you tried to attach are too large. Please try uploading files that are less than {{limit, number}} total.",{limit:l,style:"unit",unit:s,unitDisplay:"short"}):void 0},d=(0,i.createContext)(null);function MessageAttachmentsProvider(e){let t=(0,i.useState)([]);return(0,a.jsx)(d.Provider,{value:t,children:e.children})}function useMessageAttachments(){let e=(0,i.useContext)(d);if(null===e)throw Error("This can only be invoked inside MessageAttachmentsProvider");return e}function parseMimeType(e){let t=e.split(";")[0],[n,a]=t.split("/");return n&&a?[n,a]:null}var inputFooter_useFileUpload=e=>{let{bot:t,chat:a,viewer:o,onFileChange:d,onError:f}=e,{botId:h,uploadFileSizeLimit:p}=(0,l.useFragment)(n(28333),t),{fileUploadSizeLimits:g,enableFileSizeLimitsByFileType:_}=(0,l.useFragment)(n(16641),o),[F,b]=useMessageAttachments(),{t:y}=(0,r.$G)(),v=(0,i.useCallback)(e=>{let t=(0,l.readInlineData)(n(70827),a||null);e.forEach(e=>{(function(e){if(!FileReader||0!==e.size)return;let t=new FileReader;t.onload=()=>{},t.readAsBinaryString(e)})(e),(0,c.Z)("poe/action_log",{action_type:(0,m.E)(u.Z.attach_file_in_chat_input),bot_id:h,chat_id:null==t?void 0:t.chatId,action_metadata:{file_size_in_kB:Math.round(e.size/1024),file_format:e.type}})}),b(t=>{let n=[...t,...e];return null==d||d(n),n})},[d,b,h,a]),I=(0,i.useCallback)(e=>{b(t=>{let n=t.filter((t,n)=>n!==e);return null==d||d(n),n})},[b,d]),k=(0,i.useCallback)(()=>{b(()=>(null==d||d([]),[]))},[d,b]),x=(0,i.useMemo)(()=>(function(e){let t=0;for(let n of e)t+=n.size;return t})(F),[F]),S=JSON.parse(g),{isFileOverLimit:M,fileTypeOverLimit:z,fileTypeSizeLimit:D}=(0,i.useMemo)(()=>{let e,t,n;return e="",t=!1,n=S.total,F.forEach(a=>{if(t)return;n=S.total;let i=a.type,r=parseMimeType(i);if(r){let[e,t]=r;"application"===e&&(n=S.application),"audio"===e&&(n=S.audio),"image"===e&&(n=S.image),"text"===e&&(n=S.text),"video"===e&&(n=S.video),"octet-stream"===t&&(n=S.total)}a.size>n&&(e=i,t=!0)}),{isFileOverLimit:t,fileTypeOverLimit:e,fileTypeSizeLimit:n}},[F,S]),w=(0,s.xD)(z);return(0,i.useEffect)(()=>{if(_&&M){let e=getFileSizeErrorMessage(_,M,w,D,F.length,y)||"";e&&(null==f||f(e));return}if(_&&x>S.total){let e=getFileSizeErrorMessage(_,M,w,S.total,F.length,y)||"";e&&(null==f||f(e));return}if(!_&&x>p){let e=getFileSizeErrorMessage(!!_,M,w,p,F.length,y)||"";e&&(null==f||f(e))}},[M,w,D,x,F.length,_,S,p,f,y]),{files:F,handleFileUpload:v,handleFileRemove:I,clearFiles:k,isFileOverLimit:M,totalFileSize:x}}},31657:function(e,t,n){"use strict";var a=n(67294);let i=a.createContext(null);t.Z=i},30965:function(e,t,n){"use strict";var a=n(67294);let i=a.createContext(null);t.Z=i},21054:function(e,t,n){"use strict";n.d(t,{S1:function(){return GenericFileInfo},xD:function(){return useDisplayFileType}});var a=n(85893),i=n(67294),r=n(22120),l=n(22578),s=n(61134),o=n(31657),c=n(30965),u=n(53679),m=n(36411),d=n(35831),f=n(94282),h=n(12251),p=n(3687),g=n(14813),_=n(27311),F=n.n(_),b=n(24503),y=n(27460);let useMimeType=e=>{let t=(0,g.J$)(n(21558),e);return(0,g.zE)(t)?t.type:t.file.mimeType},useName=e=>{let t=(0,g.J$)(n(8205),e);return t.name},useSize=e=>{let t=(0,g.J$)(n(32515),e);return(0,g.zE)(t)?t.size:t.file.size},useUrl=e=>{let t=(0,g.J$)(n(49778),e),a=(0,i.useMemo)(()=>(0,g.zE)(t)?URL.createObjectURL(t):t.url,[t]);return a},useDisplayUrl=e=>{let t=(0,g.J$)(n(76810),e),a=useUrl(t);return!(0,g.zE)(t)&&t.localUrl||a},useIsLoading=e=>{let t=(0,g.J$)(n(80874),e);return"isOptimistic"in t&&t.isOptimistic},useDisplayFileType=e=>{let{t}=(0,r.$G)(),n=(0,s.uy)(e);if(n){let[e,a]=n;if("text"===e){if("plain"===a)return t("text");if(["csv","html"].includes(a))return a}if("application"===e){if("pdf"===a)return"pdf";if("vnd.openxmlformats-officedocument.wordprocessingml.document"===a)return"docx"}if("image"===e)return["jpeg","png"].includes(a)?a:t("image");if("video"===e)return t("video");if("audio"===e)return t("audio")}return t("file")},useDisplaySize=e=>{let{t}=(0,r.$G)(),[n,a]=(0,f.w)(e);return t("{{displaySize, number}}",{displaySize:n,unit:a,style:"unit",unitDisplay:"short"})},v={},canRenderAsImage=e=>{if(!e.startsWith("image/"))return!1;if(e.startsWith("image/jpeg")||e.startsWith("image/png")||e.startsWith("image/bmp"))return!0;if(void 0===v[e])try{let t=document.createElement("canvas");t.getContext&&t.getContext("2d")?v[e]=0==t.toDataURL(e).indexOf("data:".concat(e)):v[e]=!1}catch(t){v[e]=!1}return v[e]},GenericFileInfo=e=>{let{file:t,className:i}=e,r=(0,g.J$)(n(74214),t),l=useName(r),s=useMimeType(r),o=s.startsWith("video/"),c=s.startsWith("audio/"),u=useUrl(r),f=useSize(r),p=useIsLoading(r),_=u&&!u.startsWith("blob:")?"a":"div",b=useDisplaySize(f),v=useDisplayFileType(s);return(0,a.jsxs)(_,{className:(0,h.$)(F().fileInfo,p&&F().loading,i),...u?{href:u,target:"_blank"}:{},children:[o?(0,a.jsx)(d.Z,{className:F().icon}):c?(0,a.jsx)(y.d2,{className:F().icon}):(0,a.jsx)(m.Z,{className:F().icon}),(0,a.jsxs)("div",{className:F().textPane,children:[(0,a.jsx)("div",{className:F().title,children:l}),(0,a.jsxs)("div",{className:F().metadata,children:[(0,a.jsx)("span",{className:F().fileType,children:v})," \xb7 ",b]})]})]})},ImageInfo=e=>{let{file:t,className:r}=e,l=(0,g.J$)(n(40849),t),s=useName(l),m=useDisplayUrl(l),d=(0,i.useContext)(o.Z),f=(0,i.useContext)(c.Z),{openImageViewer:_}=(0,u.z)(),y=(0,i.useCallback)(()=>{m&&(0,p.km)(m,p.Jg.image,{botId:null==d?void 0:d.botId,messageId:null==f?void 0:f.messageId,chatId:(null==d?void 0:d.chatId)||null})},[d,f,m]),v=(0,i.useCallback)(()=>{m&&_({src:m,alt:s},()=>y)},[m,s,_,y]);return m?(0,a.jsx)("img",{suppressHydrationWarning:!0,className:(0,h.$)(F().image,r),src:m,alt:s,onClick:v}):(0,a.jsx)("div",{className:F().imageLoader,children:(0,a.jsx)(b.Z,{})})};t.ZP=e=>{let{file:t,viewer:i,className:r}=e,s=(0,g.J$)(n(97702),t),{enableImageAttachmentsForBots:o}=(0,l.useFragment)(n(52985),i),c=useMimeType(s),u=o&&canRenderAsImage(c)?ImageInfo:GenericFileInfo;return(0,a.jsx)(u,{file:s,className:r})}},48675:function(e,t,n){"use strict";var a=n(85893),i=n(67294),r=n(12251),l=n(79653),s=n.n(l);t.Z=e=>{let{children:t,className:n}=e,l=(0,i.useRef)(null),o=(0,i.useCallback)(e=>{l.current&&(e.preventDefault(),e.stopPropagation(),l.current.scrollLeft+=e.deltaY,l.current.scrollLeft+=e.deltaX)},[]);return(0,i.useEffect)(()=>{let e=l.current;return e&&e.addEventListener("wheel",o),()=>{e&&e.removeEventListener("wheel",o)}},[o]),(0,a.jsx)("div",{ref:l,className:(0,r.$)(s().container,n),children:t})}},24503:function(e,t,n){"use strict";n.d(t,{Z:function(){return patterns_LoadingSpinner}});var a,i=n(85893),r=n(67294);function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var loadingSpinner=function(e){return r.createElement("svg",_extends({viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},e),a||(a=r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 2.6a7.4 7.4 0 1 0 7.4 7.4 1 1 0 1 1 2 0A9.4 9.4 0 1 1 .6 10 9.4 9.4 0 0 1 10 .6a1 1 0 1 1 0 2Z"})))},l=n(12251),s=n(7849),o=n.n(s),c=n(70751),patterns_LoadingSpinner=e=>{let{color:t="base",size:n}=e;return(0,i.jsx)(loadingSpinner,{className:(0,l.$)(o().loadingSpinner,o()[t],n?(0,c.MQ)(n):o().defaultSize)})}},94282:function(e,t,n){"use strict";n.d(t,{w:function(){return convertBytesUnit}});let a=["byte","kilobyte","megabyte","gigabyte","terabyte","petabyte"],convertBytesUnit=e=>{if(0===e)return[0,"byte"];let t=Math.min(Math.floor(Math.log(e)/Math.log(1e3)),a.length-1);return[Math.round(e/Math.pow(1e3,t)),a[t]]}},14813:function(e,t,n){"use strict";n.d(t,{J$:function(){return useFileFragment},mj:function(){return useFilesFragment},zE:function(){return isFile}});var a=n(41143),i=n.n(a),r=n(22578);let isFile=e=>e instanceof File,useFileFragment=(e,t)=>{let n=(0,r.useFragment)(e,isFile(t)?null:t);return isFile(t)?t:n||i()(!1,"Attachment file is undefined")},zipperMerge=(e,t)=>{let n=[],a=0,i=0;for(;a<e.length||i<t.length;)a>=e.length?n.push(t[i++][1]):i>=t.length?n.push(e[a++][1]):e[a][0]<t[i][0]?n.push(e[a++][1]):n.push(t[i++][1]);return n},useFilesFragment=(e,t)=>{let n=t.map((e,t)=>[t,e]),a=n.filter(e=>isFile(e[1])),i=n.filter(e=>!isFile(e[1])),l=(0,r.useFragment)(e,i.map(e=>{let[,t]=e;return t}))||[],s=l.map((e,t)=>[i[t][0],e]);return zipperMerge(a,s)}},27311:function(e){e.exports={fileInfo:"FileInfo_fileInfo__5ZvMO",loading:"FileInfo_loading__XwVJt",icon:"FileInfo_icon__HhOin",textPane:"FileInfo_textPane__d9VVB",title:"FileInfo_title__sUM2l",metadata:"FileInfo_metadata__Wu4uZ",fileType:"FileInfo_fileType__KZDVV",image:"FileInfo_image__M_cAh",imageLoader:"FileInfo_imageLoader__czDR_"}},79653:function(e){e.exports={container:"HorizontallyScrollable_container__biWGT"}},7849:function(e){e.exports={loadingSpinner:"LoadingSpinner_loadingSpinner__vCqHc",spin:"LoadingSpinner_spin__DgELP",defaultSize:"LoadingSpinner_defaultSize__ekQCH",accent:"LoadingSpinner_accent__7GqPF",base:"LoadingSpinner_base__bJwcP"}}}]);