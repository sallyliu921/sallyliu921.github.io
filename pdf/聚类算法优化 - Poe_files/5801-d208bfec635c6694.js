(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5801],{65304:function(e,t,n){"use strict";n.r(t);let i={kind:"InlineDataFragment",name:"useSendMessageFromPreviewOptimisticChat_bot"};i.hash="7d90a0cfd17beae92e6e9bbd0c136c72",t.default=i},55735:function(e,t,n){"use strict";n.r(t);let i={kind:"InlineDataFragment",name:"useSendMessageFromPreview_bot"};i.hash="9545ec8c5d9dd69d9276b2bd63e2fca4",t.default=i},40870:function(e,t,n){"use strict";n.r(t);let i={kind:"InlineDataFragment",name:"useSendMessageFromPreview_chat"};i.hash="372ab98802a7058183f043fb03a09a34",t.default=i},13746:function(e,t,n){"use strict";var i,s,a,r,o,c,l;n.r(t);let u={fragment:{argumentDefinitions:i=[{defaultValue:null,kind:"LocalArgument",name:"optimisticChatId"}],kind:"Fragment",name:"useSendMessageFromPreview_optimisticChatQuery",selections:[{kind:"ClientExtension",selections:[{args:s=[{kind:"Variable",name:"optimisticChatId",variableName:"optimisticChatId"}],concreteType:"Chat",kind:"LinkedField",name:"optimisticChat",plural:!1,selections:[{kind:"InlineDataFragmentSpread",name:"sendMessage_chat",selections:[a={kind:"ScalarField",name:"id"},r={kind:"ScalarField",name:"chatId"},{concreteType:"Bot",kind:"LinkedField",name:"defaultBotObject",plural:!1,selections:[a,o={kind:"ScalarField",name:"nickname"}]},{kind:"InlineDataFragmentSpread",name:"sendMessage_onSuccessUpdater_chat",selections:[a],argumentDefinitions:[]},{kind:"InlineDataFragmentSpread",name:"sendMessage_onMessageSendChatUpdate_chat",selections:[a,{kind:"InlineDataFragmentSpread",name:"getChatContentType_chat",selections:[{concreteType:"Bot",kind:"LinkedField",name:"defaultBotObject",plural:!1,selections:[c={kind:"ScalarField",name:"hasMarkdownRendering"}]}],argumentDefinitions:[]}],argumentDefinitions:[]},{kind:"ClientExtension",selections:[l={kind:"ScalarField",name:"isOptimistic"}]}],argumentDefinitions:[]}]}]}],type:"QueryRoot"},kind:"Request",operation:{argumentDefinitions:i,kind:"Operation",name:"useSendMessageFromPreview_optimisticChatQuery",selections:[{kind:"ClientExtension",selections:[{args:s,concreteType:"Chat",kind:"LinkedField",name:"optimisticChat",plural:!1,selections:[a,r,l,{concreteType:"Bot",kind:"LinkedField",name:"defaultBotObject",plural:!1,selections:[a,o,c]}]}]}]},params:{cacheID:"0953389618f59ba9a826244d4d6db284",id:null,metadata:{},name:"useSendMessageFromPreview_optimisticChatQuery",operationKind:"query",text:null}};u.hash="e1f9142f9e73938b9b5c431161e974a2",t.default=u},83169:function(e,t,n){"use strict";n.d(t,{l:function(){return s}});var i,s,a=n(85893),r=n(12251),o=n(59505),c=n.n(o);(i=s||(s={}))[i.default=0]="default",i[i.destructive=1]="destructive",i[i.separator=2]="separator",t.Z=e=>{let{children:t,onClick:n,href:i,target:s,type:o=0,shrink:l=!1}=e,u=(0,r.$)(c().item,1===o&&c().destructive,2===o&&c().separator,!l&&c().notShrink);return i?(0,a.jsx)("a",{className:u,href:i,target:s,children:t}):(0,a.jsx)("button",{className:u,onClick:n,children:t})}},85832:function(e,t,n){"use strict";var i=n(85893),s=n(22049),a=n.n(s);t.Z=e=>{let{children:t}=e;return(0,i.jsx)("div",{className:a().itemList,children:t})}},20454:function(e,t,n){"use strict";n.d(t,{Z:function(){return preview_PreviewIFrame}});var i=n(85893),s=n(67294),a=n(58143),r=n(446),o=n(12251),c=n(46932),l=n(21375),u=n(12107),d=n(92635),p=n.n(d),m=n(67824),g=n(77338);let w=!1,h=new Map,v=new Map,onMessageEvent=e=>{if(!e.source||"poeFrame"!==e.data.source)return;let t=e.source,n=h.get(t);if(n)n(t,e);else{let n=v.get(t);n?n.push(e):v.set(t,[e])}},startListening=()=>{w||(window.addEventListener("message",onMessageEvent),w=!0)},registerPreviewCb=(e,t)=>{startListening(),h.set(e,t);let n=v.get(e);n&&(n.forEach(n=>t(e,n)),v.delete(e))},unregisterPreviewCb=(e,t)=>{h.get(e)===t&&h.delete(e)};var f=n(60919),_=n(22120),y=n(78410),k=n(73337),b=n(76303),C=n.n(b),I=n(30038),x=n(29664),P=n(98077),S=n(41143),Z=n.n(S),F=n(11163),M=n(22578),j=n(50241),D=n(28871),E=n(71953),L=n(8583);function readChat(e){return(0,M.readInlineData)(n(40870),e)}async function getOptimisticChat(e,t){let i=(0,M.readInlineData)(n(65304),t),s=(0,E.tR)({environment:e,bot:i}),a=await (0,M.fetchQuery)(e,n(13746),{optimisticChatId:s},{fetchPolicy:"store-or-network"}).toPromise();return Z()(null==a?void 0:a.optimisticChat,"Optimistic chat ".concat(s," not found in store")),a.optimisticChat}var preview_PreviewRequestedMessageOverlay=e=>{let{requestedMessage:t,className:r,logData:o,previewApiContext:c}=e,[l,u]=function(e,t){let{shouldShowSignupWall:i,openSignupWall:a}=(0,j.zl)(),[r,o]=(0,s.useState)({type:"idle"}),c=(0,F.useRouter)(),l=(0,L.ZP)(),{t:u}=(0,_.$G)(),d=function(){let e=(0,M.useRelayEnvironment)(),{t}=(0,_.$G)(),i=(0,L.ZP)(),a=(0,s.useCallback)(async s=>{let{requestedMessage:a,bot:r,chat:o}=s,c=(0,M.readInlineData)(n(55735),r),l=o||await getOptimisticChat(e,c);return new Promise((n,s)=>(0,D.b)({environment:e,bot:c,chat:l,prompt:a.event.data.text,files:a.event.data.attachments,setBotDetailsSidebar:()=>{},updateChatHistory:!!o,t,source:{sourceType:"preview_triggered",chatInputMetadata:{useVoiceRecord:!1}},onFailedMessageSend:e=>{s(Error(e.messageEdgeCreate.statusMessage))},onSuccessfulMessageSend(e){n(e)},setToast:i}))},[e,t,i]);return a}(),p=(0,s.useCallback)(e=>{let t=e.messageEdgeCreate.chat;if(!t)throw Error("Chat not defined");c.push("/chat/".concat(t.chatCode))},[c]),m=(0,s.useCallback)(async()=>{try{if(!t||i||!(null==t?void 0:t.loggedIn)||!t.defaultBot){a(j.dh.previewTriggeredMessage);return}o({type:"loading"});let n=await d({requestedMessage:e,bot:t.defaultBot,chat:readChat(t.chat)});!function(e){let t=e?readChat(e.chat):null,n=!t||t.isOptimistic;return n}(t)?e.dismissWithSuccess():(p(n),e.respondWithSuccessWithoutDismissing())}catch(n){o({type:"idle"}),e.dismissWithError("unknown","Something went wrong"),t.chat||l({content:n instanceof Error?n.message:u("Something went wrong."),type:L.pC.error}),console.error("Could not send preview triggered message",n)}},[e,d,p,t,i,a,l,u]);return[r,m]}(t,c),{t:d}=(0,_.$G)(),p=(0,a.E)(),m=(0,s.useCallback)(()=>{u(),o&&((0,f.Z)({...o,page_type:null!=p?p:x.Z.unknown,entry_type:g.Z.confirm_preview_triggered_message}),(0,f.T)({...o,page_type:null!=p?p:x.Z.unknown,action_type:I.Z.confirm_preview_triggered_message}))},[u,p,o]),w=(0,s.useCallback)(()=>{t.dismissWithError("userRejected","User rejected."),o&&((0,f.Z)({...o,page_type:null!=p?p:x.Z.unknown,entry_type:g.Z.reject_preview_triggered_message}),(0,f.T)({...o,page_type:null!=p?p:x.Z.unknown,action_type:I.Z.reject_preview_triggered_message}))},[t,p,o]);return(0,i.jsx)(P.Z,{className:r,icon:(0,i.jsx)(k.Z,{linked:!1,className:C().logo}),text:(0,i.jsx)("p",{children:d("You are about to send a new message.")}),actions:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(y.Z,{as:"button",theme:"primary",isLoading:"loading"===l.type,isDisabled:"idle"!==l.type,onClick:m,children:d("Confirm")}),(0,i.jsx)(y.Z,{as:"button",theme:"outline",isDisabled:"idle"!==l.type,onClick:w,children:d("Cancel")})]})})},O=n(27460),preview_PreviewSafeModeOverlay=e=>{let{onClose:t,onConfirm:n,className:s}=e,{t:a}=(0,_.$G)();return(0,i.jsx)(P.Z,{className:s,icon:(0,i.jsx)(O.au,{size:"x-lg"}),text:(0,i.jsx)("p",{children:a("We blocked this application from accessing untrusted external resources. Allowing all access for this application could share some of your information with third parties, like messages used to generate the application and your IP address.")}),actions:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(y.Z,{as:"button",theme:"outline",onClick:n,children:a("Allow all")}),(0,i.jsx)(y.Z,{as:"button",theme:"outline",onClick:t,children:a("Keep blocked")})]})})};let useIFrameListener=e=>{let[t,n]=(0,s.useState)(null);return(0,s.useEffect)(()=>{let n=null==t?void 0:t.contentWindow;if(n)return registerPreviewCb(n,e),()=>{unregisterPreviewCb(n,e)}},[t,e]),n},getIncomingPreviewMessage=e=>{if("poeFrame"!==e.data.source)return null;let t=e.data;return t},usePreviewIFrameListener=e=>{let{onReady:t,onLoaded:n,onResize:i,onLog:a,onWarn:r,onError:o,onUncaughtError:c,onFileContentsForDownload:l,onMiniAppRequest:u,onSecurityPolicyViolation:d}=e,p=(0,s.useCallback)((e,s)=>{let p=getIncomingPreviewMessage(s);if(p)switch(p.type){case"ready":null==t||t(e);break;case"loaded":null==n||n(p);break;case"resize":null==i||i(p);break;case"log":null==a||a(p);break;case"warn":null==r||r(p);break;case"error":null==o||o(p);break;case"uncaughtError":null==c||c(p);break;case"fileContentsForDownload":null==l||l(p);break;case"miniAppAPI":null==u||u(e,p);break;case"securityPolicyViolation":null==d||d(p);break;default:console.error("Unknown preview message type",p.type)}},[t,n,i,a,r,o,c,l,u,d]);return useIFrameListener(p)},NOOP=()=>{},useLoggingRef=e=>{let t=(0,a.E)(),n=(0,s.useMemo)(()=>e?{...e,page_type:t}:void 0,[t,e]),{ref:i}=(0,u.Z)(m.Z.previews,{additionalLogData:()=>n?{...n,entry_type:g.Z.viewable_impression}:{}});return(0,s.useEffect)(()=>{n&&(0,f.Z)({...n,entry_type:g.Z.impression})},[n]),n?i:NOOP},getPreviewSrc=e=>e?"https://puc.poecdn.net/preview.dce3c87f405eac07315f.html":"https://puc.poecdn.net/preview.dce3c87f405eac07315f.html?safemode=false";var preview_PreviewIFrame=e=>{let{className:t,style:n,logData:u,safeMode:d=!0,shouldShowSafeModeOverlay:m=!1,onSafeModeOverlayConfirm:g,onSafeModeOverlayDismiss:w,containerClassName:h,overlayClassName:v,previewRequestedMessage:f,previewApiContext:_,...y}=e,k=(0,l.Z)(),b=(0,s.useRef)(null),C=usePreviewIFrameListener(y),I=(0,a.E)(),x=(0,s.useMemo)(()=>u?{...u,page_type:I}:void 0,[I,u]),P=useLoggingRef(x),S=(0,s.useMemo)(()=>(0,c.Z)([C,P]),[C,P]);return k?(0,i.jsxs)("div",{className:(0,o.$)(p().container,h),ref:b,children:[(0,i.jsx)("iframe",{className:(0,o.$)(p().frame,p().stackedChild,t),style:n,ref:S,sandbox:"allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox",allow:"clipboard-write",allowFullScreen:!0,src:getPreviewSrc(d)}),f&&_&&(0,i.jsx)(preview_PreviewRequestedMessageOverlay,{className:p().stackedChild,logData:x,previewApiContext:_,requestedMessage:f}),m&&(0,i.jsx)(preview_PreviewSafeModeOverlay,{className:(0,o.$)(v,p().stackedChild),onClose:w,onConfirm:g})]}):(0,i.jsx)(r.ZP,{className:p().loadingDots})}},98077:function(e,t,n){"use strict";var i=n(85893),s=n(12251),a=n(9485),r=n.n(a);t.Z=function(e){let{children:t,icon:n,text:a,actions:o,className:c}=e;return(0,i.jsx)("div",{className:(0,s.$)(r().wrapper,c),children:(0,i.jsxs)("div",{className:r().wrapperInner,children:[n,a,(0,i.jsx)("div",{className:r().actions,children:o}),t]})})}},34478:function(e,t,n){"use strict";n.d(t,{X_:function(){return isSvgCode},lX:function(){return getPreviewContentType},q$:function(){return sendIframeMessage},vB:function(){return isHtmlCode}});var i=n(41143),s=n.n(i),a=n(45598);let getPreviewOrigin=()=>(s()((0,a.H)("https://puc.poecdn.net/preview.dce3c87f405eac07315f.html"),"Missing POE_PREVIEW_URL"),new URL("https://puc.poecdn.net/preview.dce3c87f405eac07315f.html").origin),sendIframeMessage=(e,t)=>{e.postMessage(t,getPreviewOrigin())},isHtmlCode=e=>{let t=e.trim().toLowerCase();return t.startsWith("<!doctype html>")&&(t=t.slice(15).trim()),t.startsWith("<html")},isSvgCode=e=>e.startsWith("<svg")&&e.trimEnd().endsWith("</svg>"),getPreviewContentType=e=>{var t;let{language:n,metadata:i,code:s,supportedPreviewsContentTypes:a}=e,r=null!==(t=null==i?void 0:i.split(" ").map(e=>e.split("=")).reduce((e,t)=>{let[n,i]=t;return e[n]=i,e},{}))&&void 0!==t?t:{};return"react"===r.type||"react"===n?"react":isHtmlCode(s)||"html"===n?"html":n&&a.includes(n)?n:null}},60919:function(e,t,n){"use strict";n.d(t,{T:function(){return logToActionLogUsingPreviewInteraction}});var i=n(9729),s=n(65604),a=n(40258);let logToActionLogUsingPreviewInteraction=e=>{(0,i.Z)("poe/action_log",{...e,action_metadata:{preview_language:s.Z.html,preview_type:Object.hasOwn(e,"codeblock_index")?a.Z.codeblock:a.Z.raw_html}})};t.Z=e=>(0,i.Z)("poe/poe_preview_interaction",e)},42148:function(e,t,n){"use strict";n.d(t,{Z:function(){return useOnMiniAppRequest}});var i=n(67294),s=n(34478);function respond(e,t,n){return(0,s.q$)(e,{source:"poeFrame",type:"miniAppAPI",subType:"response",requestId:t.requestId,data:n})}function useOnMiniAppRequest(){let[e,t]=(0,i.useState)(null),n=(0,i.useCallback)((n,i)=>{if("sendMessage"!==i.requestName)return console.error("unknown preview mini app message",i.requestName),respond(n,i,{success:!1,code:"badInput",message:"Unknown event: "+i.requestName});if(e){respond(n,i,{success:!1,code:"anotherConfirmationIsOpen",message:"Another message is awaiting approval."});return}t({event:i,respondWithSuccessWithoutDismissing:()=>{respond(n,i,{success:!0})},dismissWithError:(e,s)=>{respond(n,i,{success:!1,code:e,message:s}),t(null)},dismissWithSuccess:()=>{respond(n,i,{success:!0}),t(null)}})},[e,t]);return[n,e]}},58705:function(e,t,n){"use strict";var i=n(67294),s=n(34478);t.Z=function(e,t){let{inline:n=!0,miniApp:a=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=(0,i.useCallback)(i=>{switch(t){case"html":(0,s.q$)(i,{source:"poeFrame",type:"html",html:e,inline:n,miniApp:a});break;case"react":case"svg":(0,s.q$)(i,{source:"poeFrame",type:"content",content:e,contentType:t,inline:n,miniApp:a})}},[e,t,n,a]);return r}},12001:function(e,t,n){"use strict";var i=n(67294),s=n(9729),a=n(77338),r=n(60919);t.Z=(e,t)=>{let[n,o]=(0,i.useState)(!0),[c,l]=(0,i.useState)(!1),[u,d]=(0,i.useState)(!1),p=(0,i.useCallback)(()=>{if(o(!1),t){let e={...t,entry_type:a.Z.disable_safemode};(0,r.Z)(e)}},[t]),m=(0,i.useCallback)(e=>{let{blockedURI:t,disposition:n,documentURI:i,effectiveDirective:a,originalPolicy:r,referrer:o,statusCode:c,violatedDirective:u}=e;(0,s.Z)("poe/preview_csp_violation_report",{"blocked-uri":t,disposition:n,"document-uri":i,"effective-directive":a,"original-policy":r,referrer:o,"status-code":c,"violated-directive":u}),l(!0)},[]),g=(0,i.useCallback)(()=>{d(!0)},[]);return(0,i.useEffect)(()=>{u&&d(!1),c&&l(!1)},[e]),{safeMode:n,securityPolicyViolated:c,shouldShowSafeModeOverlay:n&&c&&!u,disableSafeMode:p,onSecurityPolicyViolation:m,onSafeModeOverlayDismiss:g}}},27382:function(e,t,n){"use strict";n.d(t,{v:function(){return copyToClipboard}});let copyToClipboard=async(e,t)=>{let n=Promise.resolve(e);if(void 0!==window.ClipboardItem){let e=new window.ClipboardItem({"text/plain":n.then(e=>new Blob([e],{type:"text/plain"}))});try{return await navigator.clipboard.write([e]),!0}catch(e){return t&&t(),!1}}else try{let e=window.document.createElement("textarea");window.document.body.appendChild(e),e.value=await n,e.select();let i=window.document.execCommand("copy");return i||(e.focus(),e.setSelectionRange(0,99999),i=window.document.execCommand("copy")),e.remove(),!i&&t&&t(),i}catch(e){return t&&t(),!1}}},21375:function(e,t,n){"use strict";var i=n(67294);let s=!1;t.Z=()=>{let[e,t]=(0,i.useState)(s);return(0,i.useEffect)(()=>{e||(t(!0),s=!0)},[e,t]),e}},77338:function(e,t){"use strict";var n,i;(i=n||(n={})).impression="impression",i.viewable_impression="viewable_impression",i.disable_safemode="disable_safemode",i.share="share",i.save_as_file="save_as_file",i.open_in_new_tab="open_in_new_tab",i.confirm_preview_triggered_message="confirm_preview_triggered_message",i.reject_preview_triggered_message="reject_preview_triggered_message",t.Z=n},65604:function(e,t){"use strict";var n,i;(i=n||(n={})).html="html",i.javascript="javascript",i.typescript="typescript",i.jsx="jsx",i.tsx="tsx",i.svg="svg",t.Z=n},40258:function(e,t){"use strict";var n,i;(i=n||(n={})).codeblock="codeblock",i.raw_html="raw_html",t.Z=n},59505:function(e){e.exports={item:"DropdownMenuItem_item__EIRcp",destructive:"DropdownMenuItem_destructive__Bi9MD",notShrink:"DropdownMenuItem_notShrink__AFip8",separator:"DropdownMenuItem_separator__Dzdm2"}},22049:function(e){e.exports={itemList:"DropdownMenuItemList_itemList__JiLsy"}},92635:function(e){e.exports={frame:"PreviewIFrame_frame__J9ynf",loadingDots:"PreviewIFrame_loadingDots__bR1tH",container:"PreviewIFrame_container__LZzCY",stackedChild:"PreviewIFrame_stackedChild__Fe_To"}},9485:function(e){e.exports={wrapper:"PreviewOverlayLayout_wrapper__zxNOk",wrapperInner:"PreviewOverlayLayout_wrapperInner__hm10d",actions:"PreviewOverlayLayout_actions__mLNT7"}},76303:function(e){e.exports={logo:"PreviewRequestedMessageOverlay_logo__6YSq_"}}}]);